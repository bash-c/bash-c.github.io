<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Reverse is Multiplex, You Need Pintools - localhost - Done with development, it&#39;s time to pwn.</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="M4x" />
  <meta name="description" content="intel pin 什么是 pin pin 是 intel 开发的一款二进制程序的插桩分析工具，支持 x86/x64 &amp;amp; windows/linux/mac，提供了丰富的 API 供使用者用 C/C&#43;&#43; 编写 pintool 分析程序 什" />







<meta name="generator" content="Hugo 0.68.3" />


<link rel="canonical" href="https://bash-c.github.io/post/pin-in-ctf/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f1e506a781bf25d33ffc18aa6b4e972a965c58049d27d4f92b7db2e9bf28e4bf.css" integrity="sha256-8eUGp4G/JdM//Biqa06XKpZcWASdJ9T5K32y6b8o5L8=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Reverse is Multiplex, You Need Pintools" />
<meta property="og:description" content="intel pin 什么是 pin pin 是 intel 开发的一款二进制程序的插桩分析工具，支持 x86/x64 &amp; windows/linux/mac，提供了丰富的 API 供使用者用 C/C&#43;&#43; 编写 pintool 分析程序 什" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bash-c.github.io/post/pin-in-ctf/" />
<meta property="article:published_time" content="2018-07-03T12:16:10+08:00" />
<meta property="article:modified_time" content="2018-07-03T12:16:10+08:00" />
<meta itemprop="name" content="Reverse is Multiplex, You Need Pintools">
<meta itemprop="description" content="intel pin 什么是 pin pin 是 intel 开发的一款二进制程序的插桩分析工具，支持 x86/x64 &amp; windows/linux/mac，提供了丰富的 API 供使用者用 C/C&#43;&#43; 编写 pintool 分析程序 什">
<meta itemprop="datePublished" content="2018-07-03T12:16:10&#43;08:00" />
<meta itemprop="dateModified" content="2018-07-03T12:16:10&#43;08:00" />
<meta itemprop="wordCount" content="4121">



<meta itemprop="keywords" content="intel-pin,reverse," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse is Multiplex, You Need Pintools"/>
<meta name="twitter:description" content="intel pin 什么是 pin pin 是 intel 开发的一款二进制程序的插桩分析工具，支持 x86/x64 &amp; windows/linux/mac，提供了丰富的 API 供使用者用 C/C&#43;&#43; 编写 pintool 分析程序 什"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo"># </a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      # 
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Reverse is Multiplex, You Need Pintools</h1>
      
      <div class="post-meta">
        <time datetime="2018-07-03" class="post-time">
          2018-07-03
        </time>
        <div class="post-category">
            <a href="https://bash-c.github.io/categories/how2/"> how2 </a>
            
          </div>
        <span class="more-meta"> 4121 words </span>
          <span class="more-meta"> 9 min read </span>

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是-pin">什么是 pin</a>
      <ul>
        <li><a href="#什么是插桩instrument">什么是插桩(instrument)</a></li>
      </ul>
    </li>
    <li><a href="#pin-和-pintool">pin 和 pintool</a>
      <ul>
        <li><a href="#pin-的安装pintool-的编译">pin 的安装，pintool 的编译</a></li>
        <li><a href="#pin-的使用">pin 的使用</a></li>
        <li><a href="#pintool-的分析">pintool 的分析</a></li>
      </ul>
    </li>
    <li><a href="#pin-in-ctf">pin in CTF</a>
      <ul>
        <li><a href="#ndh2k13-crackme-500">NDH2K13-crackme-500</a></li>
        <li><a href="#hxpctf-2017-main_strip">hxpCTF-2017-main_strip</a></li>
      </ul>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h1 id="intel-pin">intel pin</h1>
<h2 id="什么是-pin">什么是 pin</h2>
<p>pin 是 intel 开发的一款二进制程序的插桩分析工具，支持 x86/x64 &amp; windows/linux/mac，提供了丰富的 API 供使用者用 C/C++ 编写 pintool 分析程序</p>
<h3 id="什么是插桩instrument">什么是插桩(instrument)</h3>
<p>通俗的来说，插桩就是在已有的源代码/二进制程序中插入某些代码以便于自己分析，比如在调试时使用 printf 打印变量值就属于在源代码级别的插桩。而intel pin就是在二进制程序级别（没有源代码）插桩的一款工具</p>
<h2 id="pin-和-pintool">pin 和 pintool</h2>
<h3 id="pin-的安装pintool-的编译">pin 的安装，pintool 的编译</h3>
<p>pin 的安装很简单，这里以 64 位的 Linux 为例来说明，从 <a href="https://software.intel.com/en-us/articles/pin-a-binary-instrumentation-tool-downloads">官网</a> 上下载 pin 组件后，解压即可，在解压后的文件夹内有编译好的二进制程序 pin</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pin-3.6-gcc-linux ls
doc  extlicense  extras  ia32  intel64  LICENSE  pin  README  redist.txt  <span class="nb">source</span>
pin-3.6-gcc-linux file pin 
pin: ELF 32-bit LSB executable, Intel 80386, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, statically linked, BuildID<span class="o">[</span>sha1<span class="o">]=</span>7beaa83f9142955a6e933bf29d4a8aa1269298bc, stripped
pin-3.6-gcc-linux ./pin 
E: Missing application name
Pin: pin-3.6-97554-31f0a167d
Copyright <span class="o">(</span>c<span class="o">)</span> 2003-2017, Intel Corporation. All rights reserved.

Usage: pin <span class="o">[</span>OPTION<span class="o">]</span> <span class="o">[</span>-t &lt;tool&gt; <span class="o">[</span>&lt;toolargs&gt;<span class="o">]]</span> -- &lt;<span class="nb">command</span> line&gt;
Use -help <span class="k">for</span> a description of options
</code></pre></td></tr></table>
</div>
</div><p>在 <strong>source/tools/ManualExamples</strong> 中有一些现成的 pintool 可以使用，基本涵盖了各个模块的用法，这里以 inscount0 这个 pintool 为例介绍 pin 的使用方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pin-3.6-gcc-linux <span class="nb">cd</span> source/tools/ManualExamples
ManualExamples file inscount0.cpp
inscount0.cpp: C source, ASCII text
ManualExamples make obj-intel64/inscount0.so <span class="nv">TARGET</span><span class="o">=</span>intel64
g++ -Wall -Werror -Wno-unknown-pragmas -D__PIN__<span class="o">=</span><span class="m">1</span> -DPIN_CRT<span class="o">=</span><span class="m">1</span> -fno-stack-protector -fno-exceptions -funwind-tables -fasynchronous-unwind-tables -fno-rtti -DTARGET_IA32E -DHOST_IA32E -fPIC -DTARGET_LINUX -fabi-version<span class="o">=</span><span class="m">2</span>  -I../../../source/include/pin -I../../../source/include/pin/gen -isystem /home/m4x/pin-3.6-gcc-linux/extras/stlport/include -isystem /home/m4x/pin-3.6-gcc-linux/extras/libstdc++/include -isystem /home/m4x/pin-3.6-gcc-linux/extras/crt/include -isystem /home/m4x/pin-3.6-gcc-linux/extras/crt/include/arch-x86_64 -isystem /home/m4x/pin-3.6-gcc-linux/extras/crt/include/kernel/uapi -isystem /home/m4x/pin-3.6-gcc-linux/extras/crt/include/kernel/uapi/asm-x86 -I../../../extras/components/include -I../../../extras/xed-intel64/include/xed -I../../../source/tools/InstLib -O3 -fomit-frame-pointer -fno-strict-aliasing   -c -o obj-intel64/inscount0.o inscount0.cpp
g++ -shared -Wl,--hash-style<span class="o">=</span>sysv ../../../intel64/runtime/pincrt/crtbeginS.o -Wl,-Bsymbolic -Wl,--version-script<span class="o">=</span>../../../source/include/pin/pintool.ver -fabi-version<span class="o">=</span><span class="m">2</span>    -o obj-intel64/inscount0.so obj-intel64/inscount0.o  -L../../../intel64/runtime/pincrt -L../../../intel64/lib -L../../../intel64/lib-ext -L../../../extras/xed-intel64/lib -lpin -lxed ../../../intel64/runtime/pincrt/crtendS.o -lpin3dwarf  -ldl-dynamic -nostdlib -lstlport-dynamic -lm-dynamic -lc-dynamic -lunwind-dynamic
ManualExamples file obj-intel64/inscount0.so 
obj-intel64/inscount0.so: ELF 64-bit LSB shared object, x86-64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, BuildID<span class="o">[</span>sha1<span class="o">]=</span>3baa29dd54235acaab02edc94bf9ac377dd7b0e5, not stripped
</code></pre></td></tr></table>
</div>
</div><p>此时在 obj-intel64 下编译生成了 inscount0.so，这个 so 即为一种 pintool，功能为记录程序执行的指令的条数；</p>
<blockquote>
<p>判断 pintool 的功能可以阅读 pintool 源代码或者使用下条指令</p>
<p>$ pin -t your_pintool -h &ndash; your_application</p>
</blockquote>
<p>类似的，要编译 32 位的 pintool 可以使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">make obj-ia32/inscount0.so
</code></pre></td></tr></table>
</div>
</div><p>编译 ManualExamples 中的所有 pintool 可以使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">make all <span class="nv">TAEGET</span><span class="o">=</span>intel64
make all <span class="nv">TAEGET</span><span class="o">=</span>ia32
</code></pre></td></tr></table>
</div>
</div><h3 id="pin-的使用">pin 的使用</h3>
<p>pin 的基本命令格式如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pin -t your_pintool -- your_binary &lt;arg&gt; 
</code></pre></td></tr></table>
</div>
</div><p>以刚刚编译的 inscount0 这个 pintool 为例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">ManualExamples ../../../pin -t ./obj-intel64/inscount0.so -- /bin/ls -a
.		       inscount2.cpp	  obj-intel64
..		       inscount.out	  pinatrace.cpp
buffer_linux.cpp       inscount_tls.cpp   pin.log
buffer_windows.cpp     invocation.cpp	  proccount.cpp
countreps.cpp	       isampling.cpp	  replacesigprobed.cpp
detach.cpp	       itrace.cpp	  safecopy.cpp
divide_by_zero_unix.c  little_malloc.c	  stack-debugger.cpp
divide_by_zero_win.c   logtrace.cpp	  stack-debugger-tutorial.sln
emudiv.cpp	       makefile		  stack-debugger-tutorial.vcxproj
fibonacci.cpp	       makefile.rules	  stack-debugger-tutorial.vcxproj.filters
follow_child_app1.cpp  malloc.cpp	  statica.cpp
follow_child_app2.cpp  malloc_mt.cpp	  staticcount.cpp
follow_child_tool.cpp  malloctrace.cpp	  strace.cpp
fork_app.cpp	       myInscount0.cpp	  <span class="nb">test</span>
fork_jit_tool.cpp      myInscount1.cpp	  test.c
imageload.cpp	       myMalloctrace.cpp  test-packed
inscount0.cpp	       nonstatica.cpp	  tracer.cpp
inscount1.cpp	       obj-ia32		  w_malloctrace.cpp
ManualExamples cat inscount.out 
Count <span class="m">813449</span>
</code></pre></td></tr></table>
</div>
</div><p>inscount 默认结果保存在 inscount.out 这个文件中，在上例中，即此时 <strong>ls -a</strong> 这条命令共执行了 813449 条指令</p>
<h3 id="pintool-的分析">pintool 的分析</h3>
<p>同样以 inscount0 为例分析，查看 inscount0.cpp 的内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C++" data-lang="C++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;pin.H&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">ofstream</span> <span class="n">OutFile</span><span class="p">;</span>

<span class="c1">// The running count of instructions is kept here
</span><span class="c1">// make it static to help the compiler optimize docount
</span><span class="c1"></span><span class="k">static</span> <span class="n">UINT64</span> <span class="n">icount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// This function is called before every instruction is executed
</span><span class="c1"></span><span class="n">VOID</span> <span class="nf">docount</span><span class="p">()</span> <span class="p">{</span> <span class="n">icount</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    
<span class="c1">// Pin calls this function every time a new instruction is encountered
</span><span class="c1"></span><span class="n">VOID</span> <span class="nf">Instruction</span><span class="p">(</span><span class="n">INS</span> <span class="n">ins</span><span class="p">,</span> <span class="n">VOID</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Insert a call to docount before every instruction, no arguments are passed
</span><span class="c1"></span>    <span class="n">INS_InsertCall</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="n">IPOINT_BEFORE</span><span class="p">,</span> <span class="p">(</span><span class="n">AFUNPTR</span><span class="p">)</span><span class="n">docount</span><span class="p">,</span> <span class="n">IARG_END</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">KNOB</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">KnobOutputFile</span><span class="p">(</span><span class="n">KNOB_MODE_WRITEONCE</span><span class="p">,</span> <span class="s">&#34;pintool&#34;</span><span class="p">,</span>
    <span class="s">&#34;o&#34;</span><span class="p">,</span> <span class="s">&#34;inscount.out&#34;</span><span class="p">,</span> <span class="s">&#34;specify output file name&#34;</span><span class="p">);</span>

<span class="c1">// This function is called when the application exits
</span><span class="c1"></span><span class="n">VOID</span> <span class="nf">Fini</span><span class="p">(</span><span class="n">INT32</span> <span class="n">code</span><span class="p">,</span> <span class="n">VOID</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Write to a file since cout and cerr maybe closed by the application
</span><span class="c1"></span>    <span class="n">OutFile</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">showbase</span><span class="p">);</span>
    <span class="n">OutFile</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Count &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">icount</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">OutFile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* ===================================================================== */</span>
<span class="cm">/* Print Help Message                                                    */</span>
<span class="cm">/* ===================================================================== */</span>

<span class="n">INT32</span> <span class="nf">Usage</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;This tool counts the number of dynamic instructions executed&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">KNOB_BASE</span><span class="o">::</span><span class="n">StringKnobSummary</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* ===================================================================== */</span>
<span class="cm">/* Main                                                                  */</span>
<span class="cm">/* ===================================================================== */</span>
<span class="cm">/*   argc, argv are the entire command line: pin -t &lt;toolname&gt; -- ...    */</span>
<span class="cm">/* ===================================================================== */</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="c1">// Initialize pin
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">PIN_Init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">))</span> <span class="k">return</span> <span class="n">Usage</span><span class="p">();</span>

    <span class="n">OutFile</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">KnobOutputFile</span><span class="p">.</span><span class="n">Value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>

    <span class="c1">// Register Instruction to be called to instrument instructions
</span><span class="c1"></span>    <span class="n">INS_AddInstrumentFunction</span><span class="p">(</span><span class="n">Instruction</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// Register Fini to be called when the application exits
</span><span class="c1"></span>    <span class="n">PIN_AddFiniFunction</span><span class="p">(</span><span class="n">Fini</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    
    <span class="c1">// Start the program, never returns
</span><span class="c1"></span>    <span class="n">PIN_StartProgram</span><span class="p">();</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>从 main 开始，首先调用了 PIN_init（53 行）进行初始化，然后使用 INS_AddInstrumenFunction 注册了一个插桩函数(58行)，根据 intel pin 的 <a href="https://software.intel.com/sites/landingpage/pintool/docs/97619/Pin/html/">用户手册</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="n">PIN_CALLBACK</span> <span class="n">LEVEL_PINCLIENT</span><span class="o">::</span><span class="n">INS_AddInstrumentFunction</span>	<span class="p">(</span>	<span class="n">INS_INSTRUMENT_CALLBACK</span> 	<span class="n">fun</span><span class="p">,</span>
<span class="n">VOID</span> <span class="o">*</span> 	<span class="n">val</span> 
<span class="p">)</span>		
<span class="n">Add</span> <span class="n">a</span> <span class="n">function</span> <span class="n">used</span> <span class="n">to</span> <span class="n">instrument</span> <span class="n">at</span> <span class="n">instruction</span> <span class="n">granularity</span>

<span class="nl">Parameters</span><span class="p">:</span>
<span class="n">fun</span>	<span class="n">Instrumentation</span> <span class="n">function</span> <span class="k">for</span> <span class="n">instructions</span>
<span class="n">val</span>	<span class="n">passed</span> <span class="n">as</span> <span class="n">the</span> <span class="n">second</span> <span class="n">argument</span> <span class="n">to</span> <span class="n">the</span> <span class="n">instrumentation</span> <span class="n">function</span>
<span class="nl">Returns</span><span class="p">:</span>
<span class="n">PIN_CALLBACK</span> <span class="n">A</span> <span class="n">handle</span> <span class="n">to</span> <span class="n">a</span> <span class="n">callback</span> <span class="n">that</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">further</span> <span class="n">modify</span> <span class="n">this</span> <span class="n">callback</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">properties</span>
<span class="nl">Note</span><span class="p">:</span>
<span class="n">The</span> <span class="n">pin</span> <span class="n">client</span> <span class="n">lock</span> <span class="n">is</span> <span class="n">obtained</span> <span class="n">during</span> <span class="n">the</span> <span class="n">call</span> <span class="n">of</span> <span class="n">this</span> <span class="n">API</span><span class="p">.</span>
<span class="nl">Availability</span><span class="p">:</span>
<span class="nl">Mode</span><span class="p">:</span> <span class="n">JIT</span>
<span class="n">O</span><span class="o">/</span><span class="nl">S</span><span class="p">:</span> <span class="n">Linux</span><span class="p">,</span> <span class="n">Windows</span> <span class="o">&amp;</span> <span class="n">OS</span> <span class="n">X</span><span class="o">*</span>
<span class="nl">CPU</span><span class="p">:</span> <span class="n">All</span>
</code></pre></td></tr></table>
</div>
</div><p>在这里该函数的作用是在指令粒度插入 Instruction 函数，即在每条指令执行前，都会进入 Instruction 这个函数中，其第2个参数为一个额外传递给 Instruction 的参数，即对应 <code>VOID *v</code> 这个参数，这里没有使用。而 Instruction 接受的第一个参数为 <code>INS</code> 结构，用来表示一条指令</p>
<p>而我们再看 Instruction 这个函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="n">VOID</span> <span class="nf">Instruction</span><span class="p">(</span><span class="n">INS</span> <span class="n">ins</span><span class="p">,</span> <span class="n">VOID</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Insert a call to docount before every instruction, no arguments are passed
</span><span class="c1"></span>    <span class="n">INS_InsertCall</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="n">IPOINT_BEFORE</span><span class="p">,</span> <span class="p">(</span><span class="n">AFUNPTR</span><span class="p">)</span><span class="n">docount</span><span class="p">,</span> <span class="n">IARG_END</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在 Instruction 函数内部又使用 INS_InsertCall 注册了一个函数 docount，即在每条指令前实际插入了 docount 这个函数。需要注意的是 INS_InsertCall 试一个便餐函数，前三个参数分别为指令(ins)，插入的实际(IPOINT_BEFORE，表示在指令运行之前插入 docount 函数)，函数指针(docount，转化为了 AFUNPTR 类型)，之后的参数为传递给 docount 函数的参数，以 IARG_END 结尾</p>
<p>而 docount 函数（12 行）的作用就很明显了，每次将一个全局变量加 1，因此此时 /bin/ls -a 运行的模式如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">...
icount++;
sub $0xff, %edx
icount++;
cmp %esi, %edx
icount++;
jle &lt;L1&gt;
icount++;
mov $0x1, %edi
icount++;
add $0x10, %eax
...
</code></pre></td></tr></table>
</div>
</div><p>所以 inscount0 的用途就很明显了，每条指令前都调用 docount 函数将全局变量 icount 自增，最后通过PIN_AddFiniFunction 函数注册的 Fini 函数(25行)将结果写到一个文件中。</p>
<p>当这些函数都定义完后，就可以使用 PIN_StartProgram 来启动程序了</p>
<p>这里分析了一个最简单的 pintool 例子，更多 pintool 例子的分析和其他函数的使用可以参考 BrieflyX 的 <a href="http://brieflyx.me/2017/binary-analysis/intel-pin-intro/">博客</a></p>
<h2 id="pin-in-ctf">pin in CTF</h2>
<p>因为动态插桩有不重新编译即可收集二进制程序某些信息的特性，因此用 pin 求解<strong>一部分</strong> CTF challenges 会异常的方便，下边给出一些例子和分析</p>
<h3 id="ndh2k13-crackme-500">NDH2K13-crackme-500</h3>
<p>首先用常规方法对 crackme 文件进行分析</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">NDH2k13-crackme-500 <span class="o">[</span>master<span class="o">]</span> file crackme 
crackme: ELF 64-bit LSB executable, x86-64, invalid version <span class="o">(</span>SYSV<span class="o">)</span>, <span class="k">for</span> GNU/Linux 2.6.9, statically linked, corrupted section header size
NDH2k13-crackme-500 <span class="o">[</span>master<span class="o">]</span> nm ./crackme 

nm: out of memory allocating <span class="m">109524665216</span> bytes after a total of <span class="m">0</span> bytes
NDH2k13-crackme-500 <span class="o">[</span>master<span class="o">]</span> objdump -d ./crackme -M intel
objdump: ./crackme: 不可识别的文件格式
NDH2k13-crackme-500 <span class="o">[</span>master<span class="o">]</span> ./crackme 
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: <span class="nb">test</span>
Bad password
</code></pre></td></tr></table>
</div>
</div><p>发现 section header 受到了损坏，用 IDA 打开时也有很多报错，这时我们尝试使用 intel pin 来求解这道题目，先使用最常见的统计指令条数的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">NDH2k13-crackme-500 <span class="o">[</span>master<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./inscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;a&#34;</span> &gt;&gt; /dev/null<span class="p">;</span> cat inscount.out 
Count <span class="m">160345</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;a&#34;</span> 
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">163218</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;aa&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">166014</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;aaa&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">168810</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;aaaa&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">171606</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;aaaaa&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">174402</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> bpython
bpython version 0.17.1 on top of Python 2.7.13+ /usr/bin/python2
&gt;&gt;&gt; <span class="m">174402</span> - <span class="nv">171606</span> <span class="o">==</span> <span class="m">171606</span> - <span class="nv">168810</span> <span class="o">==</span> <span class="m">168810</span> - <span class="nv">166014</span> <span class="o">==</span> <span class="m">166014</span> - <span class="m">163218</span>
True
&gt;&gt;&gt; 
</code></pre></td></tr></table>
</div>
</div><p>此时我们发现了一个很有趣的特性，输入长度每次增加 1 时，指令条数也是以等差的规模递增的</p>
<blockquote>
<p>myInscount0 是我在 inscount0 的基础上更改的 pintool，实现了从结果保存到文件到结果输出到标准输出的修改</p>
</blockquote>
<p>我们写一个简单的脚本查看输入长度递增时，指令条数的变化规律</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">NDH2k13</span><span class="o">-</span><span class="n">crackme</span><span class="o">-</span><span class="mi">500</span> <span class="p">[</span><span class="n">master</span><span class="err">●</span><span class="p">]</span> <span class="n">cat</span> <span class="n">guessLen</span><span class="o">.</span><span class="n">py</span> 
<span class="c1">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="n">pinPath</span> <span class="o">=</span> <span class="s2">&#34;/home/m4x/pin-3.6-gcc-linux/pin&#34;</span>
<span class="n">pinInit</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tool</span><span class="p">,</span> <span class="n">elf</span><span class="p">:</span> <span class="n">Popen</span><span class="p">([</span><span class="n">pinPath</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">elf</span><span class="p">],</span> <span class="n">stdin</span> <span class="o">=</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="n">PIPE</span><span class="p">)</span>
<span class="n">pinWrite</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cont</span><span class="p">:</span> <span class="n">pin</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<span class="n">pinRead</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">pin</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">pin</span> <span class="o">=</span> <span class="n">pinInit</span><span class="p">(</span><span class="s2">&#34;./myInscount0.so&#34;</span><span class="p">,</span> <span class="s2">&#34;./crackme&#34;</span><span class="p">)</span>
        <span class="n">pinWrite</span><span class="p">(</span><span class="s2">&#34;a&#34;</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pinRead</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;Count: &#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">print</span> <span class="s2">&#34;inputLen({:2d}) -&gt; ins({}) -&gt; delta({})&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">now</span> <span class="o">-</span> <span class="n">last</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">now</span>
</code></pre></td></tr></table>
</div>
</div><p>在我电脑上运行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">NDH2k13</span><span class="o">-</span><span class="n">crackme</span><span class="o">-</span><span class="mi">500</span> <span class="p">[</span><span class="n">master</span><span class="err">●</span><span class="p">]</span> <span class="n">python</span> <span class="n">guessLen</span><span class="o">.</span><span class="n">py</span> 
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">160307</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">160307</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">163103</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">165899</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">168695</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">171491</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">174287</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">177083</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">182804</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">5721</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span> <span class="mi">9</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">182676</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">185472</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">188268</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">191064</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">193860</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">196656</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">199452</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">202248</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">205044</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">207840</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">210636</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">213432</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">216228</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">219024</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">221820</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">224616</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">227412</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">230208</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">2796</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">244188</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">13980</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">244188</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">inputLen</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ins</span><span class="p">(</span><span class="mi">244188</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">delta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>可以发现，在输入长度 &lt;8 时，指令条数是递增的，但长度为 8 与长度为 7 比较发生了突变，这个时候我们就可以大胆的推测当输入长度为 8 时，程序的运行流程有了较大的变化，正确的 flag 长度即为 8</p>
<p>我们以输入长度是 8 为前提，再查看不同输入下指令条数的变化规律</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;&gt;???????&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">185714</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;????????&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">185714</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;@???????&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">185714</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;A???????&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">189752</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;B???????&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">185714</span>
NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount0.so -- ./crackme <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;C???????&#34;</span>
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: Bad password
Count: <span class="m">185714</span>
</code></pre></td></tr></table>
</div>
</div><p>可以发现，输入以 ASCII码 顺序递增时，第一位为 A 时指令条数发生了变化，此时我们在进一步推测正确的 flag 第一位即为 A</p>
<p>再写一个脚本逐位爆破</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">NDH2k13</span><span class="o">-</span><span class="n">crackme</span><span class="o">-</span><span class="mi">500</span> <span class="p">[</span><span class="n">master</span><span class="err">●</span><span class="p">]</span> <span class="n">cat</span> <span class="n">guessPWD</span><span class="o">.</span><span class="n">py</span> 
<span class="c1">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">pdb</span>

<span class="n">pinPath</span> <span class="o">=</span> <span class="s2">&#34;/home/m4x/pin-3.6-gcc-linux/pin&#34;</span>
<span class="n">pinInit</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tool</span><span class="p">,</span> <span class="n">elf</span><span class="p">:</span> <span class="n">Popen</span><span class="p">([</span><span class="n">pinPath</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">elf</span><span class="p">],</span> <span class="n">stdin</span> <span class="o">=</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="n">PIPE</span><span class="p">)</span>
<span class="n">pinWrite</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cont</span><span class="p">:</span> <span class="n">pin</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<span class="n">pinRead</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">pin</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#  dic = map(chr, xrange(0x20, 0x80))</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s2">&#34;+_ &#34;</span>
    <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">dicIdx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pwdIdx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">pwd</span><span class="p">[:</span> <span class="n">pwdIdx</span><span class="p">]</span> <span class="o">+</span> <span class="n">dic</span><span class="p">[</span><span class="n">dicIdx</span><span class="p">]</span> <span class="o">+</span> <span class="n">pwd</span><span class="p">[</span><span class="n">pwdIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="p">]</span>
        <span class="c1">#  pdb.set_trace()</span>
        <span class="n">pin</span> <span class="o">=</span> <span class="n">pinInit</span><span class="p">(</span><span class="s2">&#34;./myInscount1.so&#34;</span><span class="p">,</span> <span class="s2">&#34;./crackme&#34;</span><span class="p">)</span>
        <span class="n">pinWrite</span><span class="p">(</span><span class="n">pwd</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pinRead</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;Count: &#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">print</span> <span class="s2">&#34;input({}) -&gt; now({}) -&gt; delta({})&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pwd</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">now</span> <span class="o">-</span> <span class="n">last</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">last</span> <span class="o">&gt;</span> <span class="mi">2000</span> <span class="ow">and</span> <span class="n">dicIdx</span><span class="p">:</span>
            <span class="n">pwdIdx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">dicIdx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">pwdIdx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pwd</span><span class="p">):</span>
                <span class="k">print</span> <span class="s2">&#34;Found pwd: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="n">dicIdx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">now</span>
</code></pre></td></tr></table>
</div>
</div><p>运行结果如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> <span class="nb">time</span> python guessPWD.py 
input<span class="o">(</span>a???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>182804<span class="o">)</span>
input<span class="o">(</span>b???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>c???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>d???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>e???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>f???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>g???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>h???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>i???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>j???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>k???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>l???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>m???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>n???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>o???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>p???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>q???????<span class="o">)</span> -&gt; now<span class="o">(</span>182804<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
......
input<span class="o">(</span>AzI0wBsO<span class="o">)</span> -&gt; now<span class="o">(</span>211070<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsP<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>-1<span class="o">)</span>
input<span class="o">(</span>AzI0wBsQ<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsR<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsS<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsT<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsU<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsV<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsW<span class="o">)</span> -&gt; now<span class="o">(</span>211069<span class="o">)</span> -&gt; delta<span class="o">(</span>0<span class="o">)</span>
input<span class="o">(</span>AzI0wBsX<span class="o">)</span> -&gt; now<span class="o">(</span>214976<span class="o">)</span> -&gt; delta<span class="o">(</span>3907<span class="o">)</span>
Found pwd: AzI0wBsX
python guessPWD.py  31.04s user 14.72s system 105% cpu 43.341 total
</code></pre></td></tr></table>
</div>
</div><p>验证一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">NDH2k13-crackme-500 <span class="o">[</span>master●<span class="o">]</span> ./crackme 
Jonathan Salwan loves you &lt;<span class="m">3</span>
----------------------------

Password: AzI0wBsX
Good password
</code></pre></td></tr></table>
</div>
</div><p>这样，我们用不到 5 分钟的时间就猜出了 flag</p>
<blockquote>
<p>inscount1(BB级插桩) 与 inscount0(ins级插桩) 效果相同，但 inscount1 速度更快，实际解题时可以用 inscount1 代替 inscount0</p>
</blockquote>
<h3 id="hxpctf-2017-main_strip">hxpCTF-2017-main_strip</h3>
<p>再以 hxpCTF2017 的一道题目演示改造 pintool 用于解题，我们着重演示改造 pintool 的步骤，因此恢复符号表和分析程序流程的部分可以参考这篇 <a href="http://eternal.red/2017/dont_panic-writeup/">writeup</a></p>
<p>我们先尝试用上例的方法解这道题目</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">hxpCTF-2017-main_strip <span class="o">[</span>master●●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount1.so -- ./main_strip a
Nope.
Count: <span class="m">517715</span>
hxpCTF-2017-main_strip <span class="o">[</span>master●●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount1.so -- ./main_strip a 
Nope.
Count: <span class="m">545828</span>
hxpCTF-2017-main_strip <span class="o">[</span>master●●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount1.so -- ./main_strip a
Nope.
Count: <span class="m">532656</span>
hxpCTF-2017-main_strip <span class="o">[</span>master●●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount1.so -- ./main_strip a
Nope.
Count: <span class="m">524544</span>
hxpCTF-2017-main_strip <span class="o">[</span>master●●<span class="o">]</span> ~/pin-3.6-gcc-linux/pin -t ./myInscount1.so -- ./main_strip a
Nope.
Count: <span class="m">582401</span>
</code></pre></td></tr></table>
</div>
</div><p>很不幸，即使我们使用同一个输入，指令数也是有较大变化的，使用现有的 pintool 难以解出这道题目，我们进行更深一步的分析，验证 flag 的关键部分可以表示为如下代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">(</span><span class="n">provided_flag</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">main_mapanic</span><span class="p">(</span><span class="n">provided_flag</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="n">constant_binary_blob</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	<span class="p">{</span>
		<span class="n">bad_boy</span><span class="p">();</span>
		<span class="n">exit</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">goodboy</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看出判断相等是逐位进行的，因此可以考虑对 inscount0 的 docount 函数做如下更改</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="err">更改前：</span>
<span class="n">VOID</span> <span class="n">docount</span><span class="p">()</span> <span class="p">{</span> <span class="n">icount</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="err">更改后：</span>
<span class="n">VOID</span> <span class="n">docount</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ip</span><span class="p">)</span> 
<span class="p">{</span>
  	<span class="c1">// .text:000000000047B96E  cmp al, cl; cmp mapanic(provided_flag[i]), constant_binary_blob[i]
</span><span class="c1"></span>	<span class="k">if</span> <span class="p">((</span><span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">ip</span> <span class="o">==</span> <span class="mh">0x000000000047B96E</span><span class="p">)</span>
	 <span class="n">icount</span><span class="o">++</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>只有运行到 0x47B96E 一句才会计数，这样我们就可以根据 pintool 的结果来逐位爆破 flag 了</p>
<blockquote>
<p>然而，因为该题目的指令较多，指令级别的插桩会耗费较长时间，需要1h左右才能得到 flag</p>
</blockquote>
<p>##　总结</p>
<ul>
<li>使用 intel pin 可以解一部分 CTF challenges，尤其是虚拟机或者混淆严重的逆向题目，但 pin 的用途绝不局限于求解 CTF challenges</li>
<li>使用 pin 可以解一部分 CTF 题目，但也仅仅是一部分题目，多数题目由于插桩代价大，难以提取侧信道信息，pintool 难以编写等原因使用 pin 求解得不偿失，因此使用 pin 求解 CTF challenges 可以总结为下条原则：
<ul>
<li>能用血赚，凉了不亏</li>
</ul>
</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="http://shell-storm.org/blog/A-binary-analysis-count-me-if-you-can/">http://shell-storm.org/blog/A-binary-analysis-count-me-if-you-can/</a></li>
<li><a href="http://brieflyx.me/2017/binary-analysis/intel-pin-intro/">http://brieflyx.me/2017/binary-analysis/intel-pin-intro/</a></li>
<li><a href="http://eternal.red/2017/dont_panic-writeup/">http://eternal.red/2017/dont_panic-writeup/</a></li>
<li><a href="https://github.com/M4xW4n9/slides/blob/master/auto/04-PinTutorial.pdf">https://github.com/M4xW4n9/slides/blob/master/auto/04-PinTutorial.pdf</a></li>
</ul>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://bash-c.github.io/tags/intel-pin/">intel-pin</a>
          <a href="https://bash-c.github.io/tags/reverse/">reverse</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/how-2-pwn-an-arm-binary/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">如何 pwn 掉一个 arm 的binary</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/hackme.inndy-writeup/">
            <span class="next-text nav-default">Hackme.Inndy 的部分 writeup</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "bash-c/bash-c.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:aboultraman@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/M4x_1997" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://github.com/bash-c" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://bash-c.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
       -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        M4x
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>












</body>
</html>
